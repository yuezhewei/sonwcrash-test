<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="24">
  <HTTPTask id="65" hostname="192.168.109.1" path="/bugfree/assets/f94ed65d/jquery.autocomplete.js" url="http://192.168.109.1:8032/bugfree/assets/f94ed65d/jquery.autocomplete.js" ip="192.168.109.1" port="8032" connectionId="12" origin="Primary" frame="1" startTime="1070276" endTime="1070276">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Accept" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cDovLzE5Mi4xNjguMTA5LjE6ODAzMi9idWdmcmVlL2luZGV4LnBocC9idWcvbGlzdC8x</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>emgtQ04=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS80LjAgKGNvbXBhdGlibGU7IE1TSUUgOC4wOyBXaW5kb3dzIE5UIDYuMTsgV09XNjQ7IFRyaWRlbnQvNC4wOyBTTENDMjsgLk5FVCBDTFIgMi4wLjUwNzI3OyAuTkVUIENMUiAzLjUuMzA3Mjk7IC5ORVQgQ0xSIDMuMC4zMDcyOSk=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Host" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MTkyLjE2OC4xMDkuMTo4MDMy</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>S2VlcC1BbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MV9wcm9kdWN0PTdjNzBkOGJhYmY2YzI2MjIyODliZGRkMmQyMDk3YzJkODkwNjg2N2NzJTNBMSUzQSUyMjElMjIlM0I7IHBhZ2VTaXplPTJkZDdiNGIyNjBmMTUxM2E3M2I4NWI1MTExNGZiNTNlZjNkOGQwNTZzJTNBMiUzQSUyMjIwJTIyJTNCOyBhYy1jb29raWU9JTVCJTdCJTIyZGF0YSUyMiUzQSU1QiUyMiU1Q3U3Y2ZiJTVDdTdlZGYlNUN1N2JhMSU1Q3U3NDA2JTVDdTU0NTglMjIlMkMlMjIlNUN1N2NmYiU1Q3U3ZWRmJTVDdTdiYTElNUN1NzQwNiU1Q3U1NDU4JTVCYWRtaW4lNUQlMjIlNUQlMkMlMjJ2YWx1ZSUyMiUzQSUyMiU1Q3U3Y2ZiJTVDdTdlZGYlNUN1N2JhMSU1Q3U3NDA2JTVDdTU0NTglMjIlMkMlMjJyZXN1bHQlMjIlM0ElMjIlNUN1N2NmYiU1Q3U3ZWRmJTVDdTdiYTElNUN1NzQwNiU1Q3U1NDU4JTIyJTdEJTVEOyBQSFBTRVNTSUQ9Z2x2NThnajFnbXBxZmhwMGwwZ3NjZm9mbjc7IGxhbmd1YWdlPTMzMTQyMTkxYzhhODk1YjUwOWNhMmZiNmY2Y2M1OTdhMzEyNWYxNThzJTNBNSUzQSUyMnpoX2NuJTIyJTNC</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9idWdmcmVlL2Fzc2V0cy9mOTRlZDY1ZC9qcXVlcnkuYXV0b2NvbXBsZXRlLmpzIEhUVFAvMS4xDQpBY2NlcHQ6ICovKg0KUmVmZXJlcjogaHR0cDovLzE5Mi4xNjguMTA5LjE6ODAzMi9idWdmcmVlL2luZGV4LnBocC9idWcvbGlzdC8xDQpBY2NlcHQtTGFuZ3VhZ2U6IHpoLUNODQpVc2VyLUFnZW50OiBNb3ppbGxhLzQuMCAoY29tcGF0aWJsZTsgTVNJRSA4LjA7IFdpbmRvd3MgTlQgNi4xOyBXT1c2NDsgVHJpZGVudC80LjA7IFNMQ0MyOyAuTkVUIENMUiAyLjAuNTA3Mjc7IC5ORVQgQ0xSIDMuNS4zMDcyOTsgLk5FVCBDTFIgMy4wLjMwNzI5KQ0KQWNjZXB0LUVuY29kaW5nOiBnemlwLCBkZWZsYXRlDQpIb3N0OiAxOTIuMTY4LjEwOS4xOjgwMzINCkNvbm5lY3Rpb246IEtlZXAtQWxpdmUNCkNvb2tpZTogMV9wcm9kdWN0PTdjNzBkOGJhYmY2YzI2MjIyODliZGRkMmQyMDk3YzJkODkwNjg2N2NzJTNBMSUzQSUyMjElMjIlM0I7IHBhZ2VTaXplPTJkZDdiNGIyNjBmMTUxM2E3M2I4NWI1MTExNGZiNTNlZjNkOGQwNTZzJTNBMiUzQSUyMjIwJTIyJTNCOyBhYy1jb29raWU9JTVCJTdCJTIyZGF0YSUyMiUzQSU1QiUyMiU1Q3U3Y2ZiJTVDdTdlZGYlNUN1N2JhMSU1Q3U3NDA2JTVDdTU0NTglMjIlMkMlMjIlNUN1N2NmYiU1Q3U3ZWRmJTVDdTdiYTElNUN1NzQwNiU1Q3U1NDU4JTVCYWRtaW4lNUQlMjIlNUQlMkMlMjJ2YWx1ZSUyMiUzQSUyMiU1Q3U3Y2ZiJTVDdTdlZGYlNUN1N2JhMSU1Q3U3NDA2JTVDdTU0NTglMjIlMkMlMjJyZXN1bHQlMjIlM0ElMjIlNUN1N2NmYiU1Q3U3ZWRmJTVDdTdiYTElNUN1NzQwNiU1Q3U1NDU4JTIyJTdEJTVEOyBQSFBTRVNTSUQ9Z2x2NThnajFnbXBxZmhwMGwwZ3NjZm9mbjc7IGxhbmd1YWdlPTMzMTQyMTkxYzhhODk1YjUwOWNhMmZiNmY2Y2M1OTdhMzEyNWYxNThzJTNBNSUzQSUyMnpoX2NuJTIyJTNCDQoNCg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="1_product" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>N2M3MGQ4YmFiZjZjMjYyMjI4OWJkZGQyZDIwOTdjMmQ4OTA2ODY3Y3MlM0ExJTNBJTIyMSUyMiUzQg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="pageSize" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MmRkN2I0YjI2MGYxNTEzYTczYjg1YjUxMTE0ZmI1M2VmM2Q4ZDA1NnMlM0EyJTNBJTIyMjAlMjIlM0I=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ac-cookie" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>JTVCJTdCJTIyZGF0YSUyMiUzQSU1QiUyMiU1Q3U3Y2ZiJTVDdTdlZGYlNUN1N2JhMSU1Q3U3NDA2JTVDdTU0NTglMjIlMkMlMjIlNUN1N2NmYiU1Q3U3ZWRmJTVDdTdiYTElNUN1NzQwNiU1Q3U1NDU4JTVCYWRtaW4lNUQlMjIlNUQlMkMlMjJ2YWx1ZSUyMiUzQSUyMiU1Q3U3Y2ZiJTVDdTdlZGYlNUN1N2JhMSU1Q3U3NDA2JTVDdTU0NTglMjIlMkMlMjJyZXN1bHQlMjIlM0ElMjIlNUN1N2NmYiU1Q3U3ZWRmJTVDdTdiYTElNUN1NzQwNiU1Q3U1NDU4JTIyJTdEJTVE</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="PHPSESSID" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Z2x2NThnajFnbXBxZmhwMGwwZ3NjZm9mbjc=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="language" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MzMxNDIxOTFjOGE4OTViNTA5Y2EyZmI2ZjZjYzU5N2EzMTI1ZjE1OHMlM0E1JTNBJTIyemhfY24lMjIlM0I=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Date" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW9uLCAyNyBNYXkgMjAxOSAwNjoyMDozMSBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Server" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QXBhY2hlLzIuNC42IChXaW4zMikgUEhQLzUuNS4x</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Last-Modified" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VHVlLCAyMCBNYXIgMjAxOCAwMTo0MDowOSBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>IjZmNDMtNTY3Y2UyNzllM2JjMi1nemlwIg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Ranges" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ynl0ZXM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Length" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>NzQyOQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Keep-Alive" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dGltZW91dD01LCBtYXg9OTU=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>S2VlcC1BbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="10">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YXBwbGljYXRpb24vamF2YXNjcmlwdA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIE9LDQpEYXRlOiBNb24sIDI3IE1heSAyMDE5IDA2OjIwOjMxIEdNVA0KU2VydmVyOiBBcGFjaGUvMi40LjYgKFdpbjMyKSBQSFAvNS41LjENCkxhc3QtTW9kaWZpZWQ6IFR1ZSwgMjAgTWFyIDIwMTggMDE6NDA6MDkgR01UDQpFVGFnOiAiNmY0My01NjdjZTI3OWUzYmMyLWd6aXAiDQpBY2NlcHQtUmFuZ2VzOiBieXRlcw0KVmFyeTogQWNjZXB0LUVuY29kaW5nDQpDb250ZW50LUVuY29kaW5nOiBnemlwDQpDb250ZW50LUxlbmd0aDogNzQyOQ0KS2VlcC1BbGl2ZTogdGltZW91dD01LCBtYXg9OTUNCkNvbm5lY3Rpb246IEtlZXAtQWxpdmUNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KDQo=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>LyoKICogalF1ZXJ5IEF1dG9jb21wbGV0ZSBwbHVnaW4gMS4xCiAqCiAqIENvcHlyaWdodCAoYykgMjAwOSBKw7ZybiBaYWVmZmVyZXIKICoKICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGFuZCBHUEwgbGljZW5zZXM6CiAqICAgaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZS5waHAKICogICBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvZ3BsLmh0bWwKICoKICogUmV2aXNpb246ICRJZDoganF1ZXJ5LmF1dG9jb21wbGV0ZS5qcyAxNSAyMDA5LTA4LTIyIDEwOjMwOjI3WiBqb2Vybi56YWVmZmVyZXIgJAogKi8KCjsoZnVuY3Rpb24oJCkgewoKJC5mbi5leHRlbmQoewogICAgYXV0b2NvbXBsZXRlcjogZnVuY3Rpb24odXJsT3JEYXRhLCBvcHRpb25zKSB7CiAgICAgICAgdmFyIGlzVXJsID0gdHlwZW9mIHVybE9yRGF0YSA9PSAic3RyaW5nIjsKICAgICAgICBvcHRpb25zID0gJC5leHRlbmQoe30sICQuQXV0b2NvbXBsZXRlci5kZWZhdWx0cywgewogICAgICAgICAgICB1cmw6IGlzVXJsID8gdXJsT3JEYXRhIDogbnVsbCwKICAgICAgICAgICAgZGF0YTogaXNVcmwgPyBudWxsIDogdXJsT3JEYXRhLAogICAgICAgICAgICBkZWxheTogaXNVcmwgPyAkLkF1dG9jb21wbGV0ZXIuZGVmYXVsdHMuZGVsYXkgOiAxMCwKICAgICAgICAgICAgbWF4OiBvcHRpb25zICYmICFvcHRpb25zLnNjcm9sbCA/IDYwIDogMTUwCiAgICAgICAgfSwgb3B0aW9ucyk7CgogICAgICAgIC8vIGlmIGhpZ2hsaWdodCBpcyBzZXQgdG8gZmFsc2UsIHJlcGxhY2UgaXQgd2l0aCBhIGRvLW5vdGhpbmcgZnVuY3Rpb24KICAgICAgICBvcHRpb25zLmhpZ2hsaWdodCA9IG9wdGlvbnMuaGlnaGxpZ2h0IHx8IGZ1bmN0aW9uKHZhbHVlKSB7cmV0dXJuIHZhbHVlO307CgogICAgICAgIC8vIGlmIHRoZSBmb3JtYXRNYXRjaCBvcHRpb24gaXMgbm90IHNwZWNpZmllZCwgdGhlbiB1c2UgZm9ybWF0SXRlbSBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkKICAgICAgICBvcHRpb25zLmZvcm1hdE1hdGNoID0gb3B0aW9ucy5mb3JtYXRNYXRjaCB8fCBvcHRpb25zLmZvcm1hdEl0ZW07CgogICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIG5ldyAkLkF1dG9jb21wbGV0ZXIodGhpcywgb3B0aW9ucyk7CiAgICAgICAgfSk7CiAgICB9LAogICAgcmVzdWx0OiBmdW5jdGlvbihoYW5kbGVyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYmluZCgicmVzdWx0IiwgaGFuZGxlcik7CiAgICB9LAogICAgc2VhcmNoOiBmdW5jdGlvbihoYW5kbGVyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudHJpZ2dlcigic2VhcmNoIiwgW2hhbmRsZXJdKTsKICAgIH0sCiAgICBmbHVzaENhY2hlOiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy50cmlnZ2VyKCJmbHVzaENhY2hlIik7CiAgICB9LAogICAgc2V0T3B0aW9uczogZnVuY3Rpb24ob3B0aW9ucyl7CiAgICAgICAgcmV0dXJuIHRoaXMudHJpZ2dlcigic2V0T3B0aW9ucyIsIFtvcHRpb25zXSk7CiAgICB9LAogICAgdW5hdXRvY29tcGxldGU6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLnRyaWdnZXIoInVuYXV0b2NvbXBsZXRlIik7CiAgICB9Cn0pOwoKJC5BdXRvY29tcGxldGVyID0gZnVuY3Rpb24oaW5wdXQsIG9wdGlvbnMpIHsKCiAgICB2YXIgS0VZID0gewogICAgICAgIFVQOiAzOCwKICAgICAgICBET1dOOiA0MCwKICAgICAgICBERUw6IDQ2LAogICAgICAgIFRBQjogOSwKICAgICAgICBSRVRVUk46IDEzLAogICAgICAgIEVTQzogMjcsCiAgICAgICAgQ09NTUE6IDE4OCwKICAgICAgICBQQUdFVVA6IDMzLAogICAgICAgIFBBR0VET1dOOiAzNCwKICAgICAgICBCQUNLU1BBQ0U6IDgKICAgIH07CgogICAgLy8gQ3JlYXRlICQgb2JqZWN0IGZvciBpbnB1dCBlbGVtZW50CiAgICB2YXIgJGlucHV0ID0gJChpbnB1dCkuYXR0cigiYXV0b2NvbXBsZXRlIiwgIm9mZiIpLmFkZENsYXNzKG9wdGlvbnMuaW5wdXRDbGFzcyk7CgogICAgdmFyIHRpbWVvdXQ7CiAgICB2YXIgcHJldmlvdXNWYWx1ZSA9ICIiOwogICAgdmFyIGNhY2hlID0gJC5BdXRvY29tcGxldGVyLkNhY2hlKG9wdGlvbnMpOwogICAgdmFyIGNvb2tpZSA9ICQuQXV0b2NvbXBsZXRlci5Db29raWUob3B0aW9ucyk7CiAgICB2YXIgaGFzRm9jdXMgPSAwOwogICAgdmFyIGxhc3RLZXlQcmVzc0NvZGU7CiAgICB2YXIgY29uZmlnID0gewogICAgICAgIG1vdXNlRG93bk9uU2VsZWN0OiBmYWxzZQogICAgfTsKICAgIHZhciBzZWxlY3QgPSAkLkF1dG9jb21wbGV0ZXIuU2VsZWN0KG9wdGlvbnMsIGlucHV0LCBzZWxlY3RDdXJyZW50LCBjb25maWcpOwoKICAgIHZhciBibG9ja1N1Ym1pdDsKCiAgICAvLyBwcmV2ZW50IGZvcm0gc3VibWl0IGluIG9wZXJhIHdoZW4gc2VsZWN0aW5nIHdpdGggcmV0dXJuIGtleQogICAgJC5icm93c2VyLm9wZXJhICYmICQoaW5wdXQuZm9ybSkuYmluZCgic3VibWl0LmF1dG9jb21wbGV0ZSIsIGZ1bmN0aW9uKCkgewogICAgICAgIGlmIChibG9ja1N1Ym1pdCkgewogICAgICAgICAgICBibG9ja1N1Ym1pdCA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfSk7CgogICAgLy8gb25seSBvcGVyYSBkb2Vzbid0IHRyaWdnZXIga2V5ZG93biBtdWx0aXBsZSB0aW1lcyB3aGlsZSBwcmVzc2VkLCBvdGhlcnMgZG9uJ3Qgd29yayB3aXRoIGtleXByZXNzIGF0IGFsbAogICAgJGlucHV0LmJpbmQoKCQuYnJvd3Nlci5vcGVyYSA/ICJrZXlwcmVzcyIgOiAia2V5ZG93biIpICsgIi5hdXRvY29tcGxldGUiLCBmdW5jdGlvbihldmVudCkgewogICAgICAgIC8vIGEga2V5cHJlc3MgbWVhbnMgdGhlIGlucHV0IGhhcyBmb2N1cwogICAgICAgIC8vIGF2b2lkcyBpc3N1ZSB3aGVyZSBpbnB1dCBoYWQgZm9jdXMgYmVmb3JlIHRoZSBhdXRvY29tcGxldGUgd2FzIGFwcGxpZWQKICAgICAgICBoYXNGb2N1cyA9IDE7CiAgICAgICAgLy8gdHJhY2sgbGFzdCBrZXkgcHJlc3NlZAogICAgICAgIGxhc3RLZXlQcmVzc0NvZGUgPSBldmVudC5rZXlDb2RlOwogICAgICAgIHN3aXRjaChldmVudC5rZXlDb2RlKSB7CgogICAgICAgICAgICBjYXNlIEtFWS5VUDoKICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICBpZiAoIHNlbGVjdC52aXNpYmxlKCkgKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZWN0LnByZXYoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2UoMCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgS0VZLkRPV046CiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgaWYgKCBzZWxlY3QudmlzaWJsZSgpICkgewogICAgICAgICAgICAgICAgICAgIHNlbGVjdC5uZXh0KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlKDAsIHRydWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIEtFWS5QQUdFVVA6CiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgaWYgKCBzZWxlY3QudmlzaWJsZSgpICkgewogICAgICAgICAgICAgICAgICAgIHNlbGVjdC5wYWdlVXAoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2UoMCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgS0VZLlBBR0VET1dOOgogICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIGlmICggc2VsZWN0LnZpc2libGUoKSApIHsKICAgICAgICAgICAgICAgICAgICBzZWxlY3QucGFnZURvd24oKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2UoMCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vIG1hdGNoZXMgYWxzbyBzZW1pY29sb24KICAgICAgICAgICAgY2FzZSBvcHRpb25zLm11bHRpcGxlICYmICQudHJpbShvcHRpb25zLm11bHRpcGxlU2VwYXJhdG9yKSA9PSAiLCIgJiYgS0VZLkNPTU1BOgogICAgICAgICAgICBjYXNlIEtFWS5UQUI6CiAgICAgICAgICAgIGNhc2UgS0VZLlJFVFVSTjoKICAgICAgICAgICAgICAgIGlmKCBzZWxlY3RDdXJyZW50KCkgKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gc3RvcCBkZWZhdWx0IHRvIHByZXZlbnQgYSBmb3JtIHN1Ym1pdCwgT3BlcmEgbmVlZHMgc3BlY2lhbCBoYW5kbGluZwogICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgYmxvY2tTdWJtaXQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBLRVkuRVNDOgogICAgICAgICAgICAgICAgc2VsZWN0LmhpZGUoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTsKICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KG9uQ2hhbmdlLCBvcHRpb25zLmRlbGF5KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0pLmZvY3VzKGZ1bmN0aW9uKCl7CiAgICAgICAgLy8gdHJhY2sgd2hldGhlciB0aGUgZmllbGQgaGFzIGZvY3VzLCB3ZSBzaG91bGRuJ3QgcHJvY2VzcyBhbnkKICAgICAgICAvLyByZXN1bHRzIGlmIHRoZSBmaWVsZCBubyBsb25nZXIgaGFzIGZvY3VzCiAgICAgICAgaGFzRm9jdXMrKzsKICAgIH0pLmJsdXIoZnVuY3Rpb24oKSB7CiAgICAgICAgaGFzRm9jdXMgPSAwOwogICAgICAgIGlmICghY29uZmlnLm1vdXNlRG93bk9uU2VsZWN0KSB7CiAgICAgICAgICAgIGhpZGVSZXN1bHRzKCk7CiAgICAgICAgfQogICAgfSkuY2xpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgLy8gc2hvdyBzZWxlY3Qgd2hlbiBjbGlja2luZyBpbiBhIGZvY3VzZWQgZmllbGQKICAgICAgICBpZiAoIGhhc0ZvY3VzKysgPiAwICYmICFzZWxlY3QudmlzaWJsZSgpICkgewogICAgICAgICAgICBvbkNoYW5nZSgwLCB0cnVlKTsKICAgICAgICB9CiAgICB9KS5iaW5kKCJzZWFyY2giLCBmdW5jdGlvbigpIHsKICAgICAgICAvLyBUT0RPIHdoeSBub3QganVzdCBzcGVjaWZ5aW5nIGJvdGggYXJndW1lbnRzPwogICAgICAgIHZhciBmbiA9IChhcmd1bWVudHMubGVuZ3RoID4gMSkgPyBhcmd1bWVudHNbMV0gOiBudWxsOwogICAgICAgIGZ1bmN0aW9uIGZpbmRWYWx1ZUNhbGxiYWNrKHEsIGRhdGEpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdDsKICAgICAgICAgICAgaWYoIGRhdGEgJiYgZGF0YS5sZW5ndGggKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpPTA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoIGRhdGFbaV0ucmVzdWx0LnRvTG93ZXJDYXNlKCkgPT0gcS50b0xvd2VyQ2FzZSgpICkgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBkYXRhW2ldOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoIHR5cGVvZiBmbiA9PSAiZnVuY3Rpb24iICkgZm4ocmVzdWx0KTsKICAgICAgICAgICAgZWxzZSAkaW5wdXQudHJpZ2dlcigicmVzdWx0IiwgcmVzdWx0ICYmIFtyZXN1bHQuZGF0YSwgcmVzdWx0LnZhbHVlXSk7CiAgICAgICAgfQogICAgICAgICQuZWFjaCh0cmltV29yZHMoJGlucHV0LnZhbCgpKSwgZnVuY3Rpb24oaSwgdmFsdWUpIHsKICAgICAgICAgICAgcmVxdWVzdCh2YWx1ZSwgZmluZFZhbHVlQ2FsbGJhY2ssIGZpbmRWYWx1ZUNhbGxiYWNrKTsKICAgICAgICB9KTsKICAgIH0pLmJpbmQoImZsdXNoQ2FjaGUiLCBmdW5jdGlvbigpIHsKICAgICAgICBjYWNoZS5mbHVzaCgpOwogICAgfSkuYmluZCgic2V0T3B0aW9ucyIsIGZ1bmN0aW9uKCkgewogICAgICAgICQuZXh0ZW5kKG9wdGlvbnMsIGFyZ3VtZW50c1sxXSk7CiAgICAgICAgLy8gaWYgd2UndmUgdXBkYXRlZCB0aGUgZGF0YSwgcmVwb3B1bGF0ZQogICAgICAgIGlmICggImRhdGEiIGluIGFyZ3VtZW50c1sxXSApCiAgICAgICAgICAgIGNhY2hlLnBvcHVsYXRlKCk7CiAgICB9KS5iaW5kKCJ1bmF1dG9jb21wbGV0ZSIsIGZ1bmN0aW9uKCkgewogICAgICAgIHNlbGVjdC51bmJpbmQoKTsKICAgICAgICAkaW5wdXQudW5iaW5kKCk7CiAgICAgICAgJChpbnB1dC5mb3JtKS51bmJpbmQoIi5hdXRvY29tcGxldGUiKTsKICAgIH0pOwoKCiAgICBmdW5jdGlvbiBzZWxlY3RDdXJyZW50KCkgewogICAgICAgIHZhciBzZWxlY3RlZCA9IHNlbGVjdC5zZWxlY3RlZCgpOwogICAgICAgIGlmKCAhc2VsZWN0ZWQgKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIGNvb2tpZS5hZGQoc2VsZWN0ZWQpOwogICAgICAgIHZhciB2ID0gc2VsZWN0ZWQucmVzdWx0OwogICAgICAgIHByZXZpb3VzVmFsdWUgPSB2OwoKICAgICAgICBpZiAoIG9wdGlvbnMubXVsdGlwbGUgKSB7CiAgICAgICAgICAgIHZhciB3b3JkcyA9IHRyaW1Xb3JkcygkaW5wdXQudmFsKCkpOwogICAgICAgICAgICBpZiAoIHdvcmRzLmxlbmd0aCA+IDAgKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VwZXJhdG9yID0gb3B0aW9ucy5tdWx0aXBsZVNlcGFyYXRvci5sZW5ndGg7CiAgICAgICAgICAgICAgICB2YXIgY3Vyc29yQXQgPSAkKGlucHV0KS5zZWxlY3Rpb24oKS5zdGFydDsKICAgICAgICAgICAgICAgIHZhciB3b3JkQXQsIHByb2dyZXNzID0gMDsKICAgICAgICAgICAgICAgICQuZWFjaCh3b3JkcywgZnVuY3Rpb24oaSwgd29yZCkgewogICAgICAgICAgICAgICAgICAgIHByb2dyZXNzICs9IHdvcmQubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIGlmIChjdXJzb3JBdCA8PSBwcm9ncmVzcykgewogICAgICAgICAgICAgICAgICAgICAgICB3b3JkQXQgPSBpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyBGb2xsb3dpbmcgcmV0dXJuIGNhdXNlZCBJRSB0byBzZXQgY3Vyc29yIHRvIHRoZSBzdGFydCBvZiB0aGUgbGluZS4KICAgICAgICAgICAgICAgICAgICAgICAgLy9yZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHByb2dyZXNzICs9IHNlcGVyYXRvcjsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgd29yZHNbd29yZEF0XSA9IHY7CiAgICAgICAgICAgICAgICAvLyBUT0RPIHRoaXMgc2hvdWxkIHNldCB0aGUgY3Vyc29yIHRvIHRoZSByaWdodCBwb3NpdGlvbiwgYnV0IGl0IGdldHMgb3ZlcnJpZGVuIHNvbWV3aGVyZQogICAgICAgICAgICAgICAgLy8kLkF1dG9jb21wbGV0ZXIuU2VsZWN0aW9uKGlucHV0LCBwcm9ncmVzcyArIHNlcGVyYXRvciwgcHJvZ3Jlc3MgKyBzZXBlcmF0b3IpOwogICAgICAgICAgICAgICAgdiA9IHdvcmRzLmpvaW4oIG9wdGlvbnMubXVsdGlwbGVTZXBhcmF0b3IgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2ICs9IG9wdGlvbnMubXVsdGlwbGVTZXBhcmF0b3I7CiAgICAgICAgfQoKICAgICAgICAkaW5wdXQudmFsKHYpOwogICAgICAgIGhpZGVSZXN1bHRzTm93KCk7CiAgICAgICAgJGlucHV0LnRyaWdnZXIoInJlc3VsdCIsIFtzZWxlY3RlZC5kYXRhLCBzZWxlY3RlZC52YWx1ZV0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIG9uQ2hhbmdlKGNyYXAsIHNraXBQcmV2Q2hlY2spIHsKICAgICAgICBpZiggbGFzdEtleVByZXNzQ29kZSA9PSBLRVkuREVMICkgewogICAgICAgICAgICBzZWxlY3QuaGlkZSgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgY3VycmVudFZhbHVlID0gJGlucHV0LnZhbCgpOwoKICAgICAgICBpZiAoICFza2lwUHJldkNoZWNrICYmIGN1cnJlbnRWYWx1ZSA9PSBwcmV2aW91c1ZhbHVlICkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBwcmV2aW91c1ZhbHVlID0gY3VycmVudFZhbHVlOwoKICAgICAgICBjdXJyZW50VmFsdWUgPSBsYXN0V29yZChjdXJyZW50VmFsdWUpOwogICAgICAgIGlmICggY3VycmVudFZhbHVlLmxlbmd0aCA+PSBvcHRpb25zLm1pbkNoYXJzKSB7CiAgICAgICAgICAgICRpbnB1dC5hZGRDbGFzcyhvcHRpb25zLmxvYWRpbmdDbGFzcyk7CiAgICAgICAgICAgIGlmICghb3B0aW9ucy5tYXRjaENhc2UpCiAgICAgICAgICAgICAgICBjdXJyZW50VmFsdWUgPSBjdXJyZW50VmFsdWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgcmVxdWVzdChjdXJyZW50VmFsdWUsIHJlY2VpdmVEYXRhLCBoaWRlUmVzdWx0c05vdyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RvcExvYWRpbmcoKTsKICAgICAgICAgICAgc2VsZWN0LmhpZGUoKTsKICAgICAgICB9CiAgICB9OwoKICAgIGZ1bmN0aW9uIHRyaW1Xb3Jkcyh2YWx1ZSkgewogICAgICAgIGlmICghdmFsdWUpCiAgICAgICAgICAgIHJldHVybiBbIiJdOwogICAgICAgIGlmICghb3B0aW9ucy5tdWx0aXBsZSkKICAgICAgICAgICAgcmV0dXJuIFskLnRyaW0odmFsdWUpXTsKICAgICAgICByZXR1cm4gJC5tYXAodmFsdWUuc3BsaXQob3B0aW9ucy5tdWx0aXBsZVNlcGFyYXRvciksIGZ1bmN0aW9uKHdvcmQpIHsKICAgICAgICAgICAgcmV0dXJuICQudHJpbSh2YWx1ZSkubGVuZ3RoID8gJC50cmltKHdvcmQpIDogbnVsbDsKICAgICAgICB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBsYXN0V29yZCh2YWx1ZSkgewogICAgICAgIGlmICggIW9wdGlvbnMubXVsdGlwbGUgKQogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgdmFyIHdvcmRzID0gdHJpbVdvcmRzKHZhbHVlKTsKICAgICAgICBpZiAod29yZHMubGVuZ3RoID09IDEpCiAgICAgICAgICAgIHJldHVybiB3b3Jkc1swXTsKICAgICAgICB2YXIgY3Vyc29yQXQgPSAkKGlucHV0KS5zZWxlY3Rpb24oKS5zdGFydDsKICAgICAgICBpZiAoY3Vyc29yQXQgPT0gdmFsdWUubGVuZ3RoKSB7CiAgICAgICAgICAgIHdvcmRzID0gdHJpbVdvcmRzKHZhbHVlKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHdvcmRzID0gdHJpbVdvcmRzKHZhbHVlLnJlcGxhY2UodmFsdWUuc3Vic3RyaW5nKGN1cnNvckF0KSwgIiIpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHdvcmRzW3dvcmRzLmxlbmd0aCAtIDFdOwogICAgfQoKICAgIC8vIGZpbGxzIGluIHRoZSBpbnB1dCBib3ggdy90aGUgZmlyc3QgbWF0Y2ggKGFzc3VtZWQgdG8gYmUgdGhlIGJlc3QgbWF0Y2gpCiAgICAvLyBxOiB0aGUgdGVybSBlbnRlcmVkCiAgICAvLyBzVmFsdWU6IHRoZSBmaXJzdCBtYXRjaGluZyByZXN1bHQKICAgIGZ1bmN0aW9uIGF1dG9GaWxsKHEsIHNWYWx1ZSl7CiAgICAgICAgLy8gYXV0b2ZpbGwgaW4gdGhlIGNvbXBsZXRlIGJveCB3L3RoZSBmaXJzdCBtYXRjaCBhcyBsb25nIGFzIHRoZSB1c2VyIGhhc24ndCBlbnRlcmVkIGluIG1vcmUgZGF0YQogICAgICAgIC8vIGlmIHRoZSBsYXN0IHVzZXIga2V5IHByZXNzZWQgd2FzIGJhY2tzcGFjZSwgZG9uJ3QgYXV0b2ZpbGwKICAgICAgICBpZiggb3B0aW9ucy5hdXRvRmlsbCAmJiAobGFzdFdvcmQoJGlucHV0LnZhbCgpKS50b0xvd2VyQ2FzZSgpID09IHEudG9Mb3dlckNhc2UoKSkgJiYgbGFzdEtleVByZXNzQ29kZSAhPSBLRVkuQkFDS1NQQUNFICkgewogICAgICAgICAgICAvLyBmaWxsIGluIHRoZSB2YWx1ZSAoa2VlcCB0aGUgY2FzZSB0aGUgdXNlciBoYXMgdHlwZWQpCiAgICAgICAgICAgICRpbnB1dC52YWwoJGlucHV0LnZhbCgpICsgc1ZhbHVlLnN1YnN0cmluZyhsYXN0V29yZChwcmV2aW91c1ZhbHVlKS5sZW5ndGgpKTsKICAgICAgICAgICAgLy8gc2VsZWN0IHRoZSBwb3J0aW9uIG9mIHRoZSB2YWx1ZSBub3QgdHlwZWQgYnkgdGhlIHVzZXIgKHNvIHRoZSBuZXh0IGNoYXJhY3RlciB3aWxsIGVyYXNlKQogICAgICAgICAgICAkKGlucHV0KS5zZWxlY3Rpb24ocHJldmlvdXNWYWx1ZS5sZW5ndGgsIHByZXZpb3VzVmFsdWUubGVuZ3RoICsgc1ZhbHVlLmxlbmd0aCk7CiAgICAgICAgfQogICAgfTsKCiAgICBmdW5jdGlvbiBoaWRlUmVzdWx0cygpIHsKICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQoaGlkZVJlc3VsdHNOb3csIDIwMCk7CiAgICB9OwoKICAgIGZ1bmN0aW9uIGhpZGVSZXN1bHRzTm93KCkgewogICAgICAgIHZhciB3YXNWaXNpYmxlID0gc2VsZWN0LnZpc2libGUoKTsKICAgICAgICBzZWxlY3QuaGlkZSgpOwogICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTsKICAgICAgICBzdG9wTG9hZGluZygpOwogICAgICAgIGlmIChvcHRpb25zLm11c3RNYXRjaCkgewogICAgICAgICAgICAvLyBjYWxsIHNlYXJjaCBhbmQgcnVuIGNhbGxiYWNrCiAgICAgICAgICAgICRpbnB1dC5zZWFyY2goCiAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzdWx0KXsKICAgICAgICAgICAgICAgICAgICAvLyBpZiBubyB2YWx1ZSBmb3VuZCwgY2xlYXIgdGhlIGlucHV0IGJveAogICAgICAgICAgICAgICAgICAgIGlmKCAhcmVzdWx0ICkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5tdWx0aXBsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHdvcmRzID0gdHJpbVdvcmRzKCRpbnB1dC52YWwoKSkuc2xpY2UoMCwgLTEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGlucHV0LnZhbCggd29yZHMuam9pbihvcHRpb25zLm11bHRpcGxlU2VwYXJhdG9yKSArICh3b3Jkcy5sZW5ndGggPyBvcHRpb25zLm11bHRpcGxlU2VwYXJhdG9yIDogIiIpICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW5wdXQudmFsKCAiIiApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGlucHV0LnRyaWdnZXIoInJlc3VsdCIsIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH07CgogICAgZnVuY3Rpb24gcmVjZWl2ZURhdGEocSwgZGF0YSkgewogICAgICAgIGlmICggZGF0YSAmJiBkYXRhLmxlbmd0aCAmJiBoYXNGb2N1cyApIHsKICAgICAgICAgICAgc3RvcExvYWRpbmcoKTsKICAgICAgICAgICAgc2VsZWN0LmRpc3BsYXkoZGF0YSwgcSk7CiAgICAgICAgICAgIGF1dG9GaWxsKHEsIGRhdGFbMF0udmFsdWUpOwogICAgICAgICAgICBzZWxlY3Quc2hvdygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGhpZGVSZXN1bHRzTm93KCk7CiAgICAgICAgfQogICAgfTsKCiAgICBmdW5jdGlvbiByZXF1ZXN0KHRlcm0sIHN1Y2Nlc3MsIGZhaWx1cmUpIHsKICAgICAgICBpZiAoIW9wdGlvbnMubWF0Y2hDYXNlKQogICAgICAgICAgICB0ZXJtID0gdGVybS50b0xvd2VyQ2FzZSgpOwogICAgICAgIHZhciBkYXRhID0gY2FjaGUubG9hZCh0ZXJtKTsKICAgICAgICAvLyByZWNpZXZlIHRoZSBjYWNoZWQgZGF0YQogICAgICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoKSB7CiAgICAgICAgICAgIHN1Y2Nlc3ModGVybSwgZGF0YSk7CiAgICAgICAgLy8gaWYgYW4gQUpBWCB1cmwgaGFzIGJlZW4gc3VwcGxpZWQsIHRyeSBsb2FkaW5nIHRoZSBkYXRhIG5vdwogICAgICAgIH0gZWxzZSBpZiggKHR5cGVvZiBvcHRpb25zLnVybCA9PSAic3RyaW5nIikgJiYgKG9wdGlvbnMudXJsLmxlbmd0aCA+IDApICl7CgogICAgICAgICAgICB2YXIgZXh0cmFQYXJhbXMgPSB7CiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6ICtuZXcgRGF0ZSgpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgICQuZWFjaChvcHRpb25zLmV4dHJhUGFyYW1zLCBmdW5jdGlvbihrZXksIHBhcmFtKSB7CiAgICAgICAgICAgICAgICBleHRyYVBhcmFtc1trZXldID0gdHlwZW9mIHBhcmFtID09ICJmdW5jdGlvbiIgPyBwYXJhbSgpIDogcGFyYW07CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIC8vIHRyeSB0byBsZXZlcmFnZSBhamF4UXVldWUgcGx1Z2luIHRvIGFib3J0IHByZXZpb3VzIHJlcXVlc3RzCiAgICAgICAgICAgICAgICBtb2RlOiAiYWJvcnQiLAogICAgICAgICAgICAgICAgLy8gbGltaXQgYWJvcnRpb24gdG8gdGhpcyBpbnB1dAogICAgICAgICAgICAgICAgcG9ydDogImF1dG9jb21wbGV0ZSIgKyBpbnB1dC5uYW1lLAogICAgICAgICAgICAgICAgZGF0YVR5cGU6IG9wdGlvbnMuZGF0YVR5cGUsCiAgICAgICAgICAgICAgICB1cmw6IG9wdGlvbnMudXJsLAogICAgICAgICAgICAgICAgZGF0YTogJC5leHRlbmQoewogICAgICAgICAgICAgICAgICAgIHE6IGxhc3RXb3JkKHRlcm0pLAogICAgICAgICAgICAgICAgICAgIGxpbWl0OiBvcHRpb25zLm1heAogICAgICAgICAgICAgICAgfSwgZXh0cmFQYXJhbXMpLAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHZhciBwYXJzZWQgPSBvcHRpb25zLnBhcnNlICYmIG9wdGlvbnMucGFyc2UoZGF0YSkgfHwgcGFyc2UoZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgY2FjaGUuYWRkKHRlcm0sIHBhcnNlZCk7CiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzcyh0ZXJtLCBwYXJzZWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBpZiB3ZSBoYXZlIGEgZmFpbHVyZSwgd2UgbmVlZCB0byBlbXB0eSB0aGUgbGlzdCAtLSB0aGlzIHByZXZlbnRzIHRoZSB0aGUgW1RBQl0ga2V5IGZyb20gc2VsZWN0aW5nIHRoZSBsYXN0IHN1Y2Nlc3NmdWwgbWF0Y2gKICAgICAgICAgICAgc2VsZWN0LmVtcHR5TGlzdCgpOwogICAgICAgICAgICBmYWlsdXJlKHRlcm0pOwogICAgICAgIH0KICAgIH07CgogICAgZnVuY3Rpb24gcGFyc2UoZGF0YSkgewogICAgICAgIHZhciBwYXJzZWQgPSBbXTsKICAgICAgICB2YXIgcm93cyA9IGRhdGEuc3BsaXQoIlxuIik7CiAgICAgICAgZm9yICh2YXIgaT0wOyBpIDwgcm93cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgcm93ID0gJC50cmltKHJvd3NbaV0pOwogICAgICAgICAgICBpZiAocm93KSB7CiAgICAgICAgICAgICAgICByb3cgPSByb3cuc3BsaXQoInwiKTsKICAgICAgICAgICAgICAgIHBhcnNlZFtwYXJzZWQubGVuZ3RoXSA9IHsKICAgICAgICAgICAgICAgICAgICBkYXRhOiByb3csCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHJvd1swXSwKICAgICAgICAgICAgICAgICAgICByZXN1bHQ6IG9wdGlvbnMuZm9ybWF0UmVzdWx0ICYmIG9wdGlvbnMuZm9ybWF0UmVzdWx0KHJvdywgcm93WzBdKSB8fCByb3dbMF0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBhcnNlZDsKICAgIH07CgogICAgZnVuY3Rpb24gc3RvcExvYWRpbmcoKSB7CiAgICAgICAgJGlucHV0LnJlbW92ZUNsYXNzKG9wdGlvbnMubG9hZGluZ0NsYXNzKTsKICAgIH07Cgp9OwoKJC5BdXRvY29tcGxldGVyLmRlZmF1bHRzID0gewogICAgaW5wdXRDbGFzczogImFjX2lucHV0IiwKICAgIHJlc3VsdHNDbGFzczogImFjX3Jlc3VsdHMiLAogICAgbG9hZGluZ0NsYXNzOiAiYWNfbG9hZGluZyIsCiAgICBtaW5DaGFyczogMCwKICAgIGRlbGF5OiA0MDAsCiAgICBtYXRjaENhc2U6IGZhbHNlLAogICAgbWF0Y2hTdWJzZXQ6IHRydWUsCiAgICBtYXRjaENvbnRhaW5zOiBmYWxzZSwKICAgIGNhY2hlTGVuZ3RoOiAxMCwKICAgIGNvb2tpZUxlbmd0aDogMTAsCiAgICBjb29raWVJZDogJ2FjLWNvb2tpZScsCiAgICBjb29raWVPcHRpb246IHtleHBpcmVzOiAzMCwgcGF0aDogJy8nfSwKICAgIG1heDogMTAwLAogICAgbXVzdE1hdGNoOiBmYWxzZSwKICAgIGV4dHJhUGFyYW1zOiB7fSwKICAgIHNlbGVjdEZpcnN0OiB0cnVlLAogICAgZm9ybWF0SXRlbTogZnVuY3Rpb24ocm93LGksbWF4KSB7cmV0dXJuIHJvd1sxXTt9LAogICAgZm9ybWF0UmVzdWx0OiBmdW5jdGlvbihyb3cpe3JldHVybiByb3dbMF07fSwKICAgIGZvcm1hdE1hdGNoOiBudWxsLAogICAgYXV0b0ZpbGw6IGZhbHNlLAogICAgd2lkdGg6IDAsCiAgICBtdWx0aXBsZTogZmFsc2UsCiAgICBtdWx0aXBsZVNlcGFyYXRvcjogIiwiLAogICAgaGlnaGxpZ2h0OiBmdW5jdGlvbih2YWx1ZSwgdGVybSkgewogICAgICAgIHJldHVybiB2YWx1ZS5yZXBsYWNlKG5ldyBSZWdFeHAoIig/IVteJjtdKzspKD8hPFtePD5dKikoIiArIHRlcm0ucmVwbGFjZSgvKFtcXlwkXChcKVxbXF1ce1x9XCpcLlwrXD9cfFxcXSkvZ2ksICJcXCQxIikgKyAiKSg/IVtePD5dKj4pKD8hW14mO10rOykiLCAiZ2kiKSwgIjxzdHJvbmc+JDE8L3N0cm9uZz4iKTsKICAgIH0sCiAgICBzY3JvbGw6IHRydWUsCiAgICBzY3JvbGxIZWlnaHQ6IDM2MAp9OwoKJC5BdXRvY29tcGxldGVyLkNhY2hlID0gZnVuY3Rpb24ob3B0aW9ucykgewoKICAgIHZhciBkYXRhID0ge307CiAgICB2YXIgbGVuZ3RoID0gMDsKICAgIHZhciBjb29raWUgPSAkLkF1dG9jb21wbGV0ZXIuQ29va2llKG9wdGlvbnMpOwoKICAgIGZ1bmN0aW9uIG1hdGNoU3Vic2V0KHMsIHN1YikgewogICAgICAgIGlmICghb3B0aW9ucy5tYXRjaENhc2UpCiAgICAgICAgICAgIHMgPSBzLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgdmFyIGkgPSBzLmluZGV4T2Yoc3ViKTsKICAgICAgICBpZiAob3B0aW9ucy5tYXRjaENvbnRhaW5zID09ICJ3b3JkIil7CiAgICAgICAgICAgIGkgPSBzLnRvTG93ZXJDYXNlKCkuc2VhcmNoKCJcXGIiICsgc3ViLnRvTG93ZXJDYXNlKCkpOwogICAgICAgIH0KICAgICAgICBpZiAoaSA9PSAtMSkgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBpID09IDAgfHwgb3B0aW9ucy5tYXRjaENvbnRhaW5zOwogICAgfTsKCiAgICBmdW5jdGlvbiBhZGQocSwgdmFsdWUpIHsKICAgICAgICBpZiAobGVuZ3RoID4gb3B0aW9ucy5jYWNoZUxlbmd0aCl7CiAgICAgICAgICAgIGZsdXNoKCk7CiAgICAgICAgfQogICAgICAgIGlmICghZGF0YVtxXSl7CiAgICAgICAgICAgIGxlbmd0aCsrOwogICAgICAgIH0KICAgICAgICBkYXRhW3FdID0gdmFsdWU7CiAgICB9CgogICAgZnVuY3Rpb24gcG9wdWxhdGUoKXsKICAgICAgICBpZiggIW9wdGlvbnMuZGF0YSApIHJldHVybiBmYWxzZTsKICAgICAgICAvLyB0cmFjayB0aGUgbWF0Y2hlcwogICAgICAgIHZhciBzdE1hdGNoU2V0cyA9IHt9LAogICAgICAgICAgICBudWxsRGF0YSA9IDA7CgogICAgICAgIC8vIG5vIHVybCB3YXMgc3BlY2lmaWVkLCB3ZSBuZWVkIHRvIGFkanVzdCB0aGUgY2FjaGUgbGVuZ3RoIHRvIG1ha2Ugc3VyZSBpdCBmaXRzIHRoZSBsb2NhbCBkYXRhIHN0b3JlCiAgICAgICAgaWYoICFvcHRpb25zLnVybCApIG9wdGlvbnMuY2FjaGVMZW5ndGggPSAxOwoKICAgICAgICAvLyB0cmFjayBhbGwgb3B0aW9ucyBmb3IgbWluQ2hhcnMgPSAwCiAgICAgICAgc3RNYXRjaFNldHNbIiJdID0gW107CgogICAgICAgIC8vIGxvb3AgdGhyb3VnaCB0aGUgYXJyYXkgYW5kIGNyZWF0ZSBhIGxvb2t1cCBzdHJ1Y3R1cmUKICAgICAgICBmb3IgKCB2YXIgaSA9IDAsIG9sID0gb3B0aW9ucy5kYXRhLmxlbmd0aDsgaSA8IG9sOyBpKysgKSB7CiAgICAgICAgICAgIHZhciByYXdWYWx1ZSA9IG9wdGlvbnMuZGF0YVtpXTsKICAgICAgICAgICAgLy8gaWYgcmF3VmFsdWUgaXMgYSBzdHJpbmcsIG1ha2UgYW4gYXJyYXkgb3RoZXJ3aXNlIGp1c3QgcmVmZXJlbmNlIHRoZSBhcnJheQogICAgICAgICAgICByYXdWYWx1ZSA9ICh0eXBlb2YgcmF3VmFsdWUgPT0gInN0cmluZyIpID8gW3Jhd1ZhbHVlXSA6IHJhd1ZhbHVlOwoKICAgICAgICAgICAgdmFyIHZhbHVlID0gb3B0aW9ucy5mb3JtYXRNYXRjaChyYXdWYWx1ZSwgaSsxLCBvcHRpb25zLmRhdGEubGVuZ3RoKTsKICAgICAgICAgICAgaWYgKCB2YWx1ZSA9PT0gZmFsc2UgKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICB2YXIgZmlyc3RDaGFyID0gdmFsdWUuY2hhckF0KDApLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIC8vIGlmIG5vIGxvb2t1cCBhcnJheSBmb3IgdGhpcyBjaGFyYWN0ZXIgZXhpc3RzLCBsb29rIGl0IHVwIG5vdwogICAgICAgICAgICBpZiggIXN0TWF0Y2hTZXRzW2ZpcnN0Q2hhcl0gKQogICAgICAgICAgICAgICAgc3RNYXRjaFNldHNbZmlyc3RDaGFyXSA9IFtdOwoKICAgICAgICAgICAgLy8gaWYgdGhlIG1hdGNoIGlzIGEgc3RyaW5nCiAgICAgICAgICAgIHZhciByb3cgPSB7CiAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgICAgICBkYXRhOiByYXdWYWx1ZSwKICAgICAgICAgICAgICAgIHJlc3VsdDogb3B0aW9ucy5mb3JtYXRSZXN1bHQgJiYgb3B0aW9ucy5mb3JtYXRSZXN1bHQocmF3VmFsdWUpIHx8IHZhbHVlCiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBwdXNoIHRoZSBjdXJyZW50IG1hdGNoIGludG8gdGhlIHNldCBsaXN0CiAgICAgICAgICAgIHN0TWF0Y2hTZXRzW2ZpcnN0Q2hhcl0ucHVzaChyb3cpOwoKICAgICAgICAgICAgLy8ga2VlcCB0cmFjayBvZiBtaW5DaGFycyB6ZXJvIGl0ZW1zCiAgICAgICAgICAgIGlmICggbnVsbERhdGErKyA8IG9wdGlvbnMubWF4ICkgewogICAgICAgICAgICAgICAgc3RNYXRjaFNldHNbIiJdLnB1c2gocm93KTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIC8vIGFkZCB0aGUgZGF0YSBpdGVtcyB0byB0aGUgY2FjaGUKICAgICAgICAkLmVhY2goc3RNYXRjaFNldHMsIGZ1bmN0aW9uKGksIHZhbHVlKSB7CiAgICAgICAgICAgIC8vIGluY3JlYXNlIHRoZSBjYWNoZSBzaXplCiAgICAgICAgICAgIG9wdGlvbnMuY2FjaGVMZW5ndGgrKzsKICAgICAgICAgICAgLy8gYWRkIHRvIHRoZSBjYWNoZQogICAgICAgICAgICBhZGQoaSwgdmFsdWUpOwogICAgICAgIH0pOwogICAgfQoKICAgIC8vIHBvcHVsYXRlIGFueSBleGlzdGluZyBkYXRhCiAgICBzZXRUaW1lb3V0KHBvcHVsYXRlLCAyNSk7CgogICAgZnVuY3Rpb24gZmx1c2goKXsKICAgICAgICBkYXRhID0ge307CiAgICAgICAgbGVuZ3RoID0gMDsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIGZsdXNoOiBmbHVzaCwKICAgICAgICBhZGQ6IGFkZCwKICAgICAgICBwb3B1bGF0ZTogcG9wdWxhdGUsCiAgICAgICAgbG9hZDogZnVuY3Rpb24ocSkgewogICAgICAgICAgICBpZighcSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNvb2tpZS5nZXQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIW9wdGlvbnMuY2FjaGVMZW5ndGggfHwgIWxlbmd0aCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAvKgogICAgICAgICAgICAgKiBpZiBkZWFsaW5nIHcvbG9jYWwgZGF0YSBhbmQgbWF0Y2hDb250YWlucyB0aGFuIHdlIG11c3QgbWFrZSBzdXJlCiAgICAgICAgICAgICAqIHRvIGxvb3AgdGhyb3VnaCBhbGwgdGhlIGRhdGEgY29sbGVjdGlvbnMgbG9va2luZyBmb3IgbWF0Y2hlcwogICAgICAgICAgICAgKi8KICAgICAgICAgICAgaWYoICFvcHRpb25zLnVybCAmJiBvcHRpb25zLm1hdGNoQ29udGFpbnMgKXsKICAgICAgICAgICAgICAgIC8vIHRyYWNrIGFsbCBtYXRjaGVzCiAgICAgICAgICAgICAgICB2YXIgY3N1YiA9IFtdOwogICAgICAgICAgICAgICAgLy8gbG9vcCB0aHJvdWdoIGFsbCB0aGUgZGF0YSBncmlkcyBmb3IgbWF0Y2hlcwogICAgICAgICAgICAgICAgZm9yKCB2YXIgayBpbiBkYXRhICl7CiAgICAgICAgICAgICAgICAgICAgLy8gZG9uJ3Qgc2VhcmNoIHRocm91Z2ggdGhlIHN0TWF0Y2hTZXRzWyIiXSAobWluQ2hhcnM6IDApIGNhY2hlCiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcyBwcmV2ZW50cyBkdXBsaWNhdGVzCiAgICAgICAgICAgICAgICAgICAgaWYoIGsubGVuZ3RoID4gMCApewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGRhdGFba107CiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChjLCBmdW5jdGlvbihpLCB4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSd2ZSBnb3QgYSBtYXRjaCwgYWRkIGl0IHRvIHRoZSBhcnJheQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoU3Vic2V0KHgudmFsdWUsIHEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3N1Yi5wdXNoKHgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gY3N1YjsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBpZiB0aGUgZXhhY3QgaXRlbSBleGlzdHMsIHVzZSBpdAogICAgICAgICAgICBlbHNlIGlmIChkYXRhW3FdKXsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhW3FdOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgaWYgKG9wdGlvbnMubWF0Y2hTdWJzZXQpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBxLmxlbmd0aCAtIDE7IGkgPj0gb3B0aW9ucy5taW5DaGFyczsgaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBkYXRhW3Euc3Vic3RyKDAsIGkpXTsKICAgICAgICAgICAgICAgICAgICBpZiAoYykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3N1YiA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goYywgZnVuY3Rpb24oaSwgeCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoU3Vic2V0KHgudmFsdWUsIHEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3N1Yltjc3ViLmxlbmd0aF0gPSB4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNzdWI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH07Cn07CgokLkF1dG9jb21wbGV0ZXIuQ29va2llID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIHZhciBkYXRhID0gJC5jb29raWUob3B0aW9ucy5jb29raWVJZCk7CiAgICAgICAgaWYoZGF0YSkgewogICAgICAgICAgICBkYXRhID0gZXZhbCgnKCcgKyBkYXRhICsgJyknKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkKHNlbGVjdGVkKSB7CiAgICAgICAgaWYoc2VsZWN0ZWQpIHsKICAgICAgICAgICAgdmFyIGRhdGEgPSBnZXQoKTsKICAgICAgICAgICAgaWYoZGF0YSkgewogICAgICAgICAgICAgICAgdmFyIHBvcyA9IC0xOwogICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGRhdGFbaV07CiAgICAgICAgICAgICAgICAgICAgaWYoaXRlbS52YWx1ZSA9PSBzZWxlY3RlZC52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBwb3MgPSBpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZigtMSA9PSBwb3MpIHsKICAgICAgICAgICAgICAgICAgICBpZihkYXRhLmxlbmd0aCA+PSBvcHRpb25zLmNvb2tpZUxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnBvcCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBkYXRhLnVuc2hpZnQoc2VsZWN0ZWQpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gZGF0YVswXTsKICAgICAgICAgICAgICAgICAgICBkYXRhWzBdID0gZGF0YVtwb3NdOwogICAgICAgICAgICAgICAgICAgIGRhdGFbcG9zXSA9IHRtcDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRhdGEgPSBuZXcgQXJyYXkoKTsKICAgICAgICAgICAgICAgIGRhdGEucHVzaChzZWxlY3RlZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGF0YSA9IEpTT04uc3RyaW5naWZ5KGRhdGEpOwogICAgICAgICAgICAkLmNvb2tpZShvcHRpb25zLmNvb2tpZUlkLCBkYXRhLCBvcHRpb25zLmNvb2tpZU9wdGlvbik7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgZ2V0OiBnZXQsCiAgICAgICAgYWRkOiBhZGQKICAgIH0KfTsKCiQuQXV0b2NvbXBsZXRlci5TZWxlY3QgPSBmdW5jdGlvbiAob3B0aW9ucywgaW5wdXQsIHNlbGVjdCwgY29uZmlnKSB7CiAgICB2YXIgQ0xBU1NFUyA9IHsKICAgICAgICBBQ1RJVkU6ICJhY19vdmVyIgogICAgfTsKCiAgICB2YXIgbGlzdEl0ZW1zLAogICAgICAgIGFjdGl2ZSA9IC0xLAogICAgICAgIGRhdGEsCiAgICAgICAgdGVybSA9ICIiLAogICAgICAgIG5lZWRzSW5pdCA9IHRydWUsCiAgICAgICAgZWxlbWVudCwKICAgICAgICBsaXN0OwoKICAgIC8vIENyZWF0ZSByZXN1bHRzCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIGlmICghbmVlZHNJbml0KQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZWxlbWVudCA9ICQoIjxkaXYvPiIpCiAgICAgICAgLmhpZGUoKQogICAgICAgIC5hZGRDbGFzcyhvcHRpb25zLnJlc3VsdHNDbGFzcykKICAgICAgICAuY3NzKCJwb3NpdGlvbiIsICJhYnNvbHV0ZSIpCiAgICAgICAgLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpOwoKICAgICAgICBsaXN0ID0gJCgiPHVsLz4iKS5hcHBlbmRUbyhlbGVtZW50KS5tb3VzZW92ZXIoIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgIGlmKHRhcmdldChldmVudCkubm9kZU5hbWUgJiYgdGFyZ2V0KGV2ZW50KS5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpID09ICdMSScpIHsKICAgICAgICAgICAgICAgIGFjdGl2ZSA9ICQoImxpIiwgbGlzdCkucmVtb3ZlQ2xhc3MoQ0xBU1NFUy5BQ1RJVkUpLmluZGV4KHRhcmdldChldmVudCkpOwogICAgICAgICAgICAgICAgJCh0YXJnZXQoZXZlbnQpKS5hZGRDbGFzcyhDTEFTU0VTLkFDVElWRSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KS5jbGljayhmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAkKHRhcmdldChldmVudCkpLmFkZENsYXNzKENMQVNTRVMuQUNUSVZFKTsKICAgICAgICAgICAgc2VsZWN0KCk7CiAgICAgICAgICAgIC8vIFRPRE8gcHJvdmlkZSBvcHRpb24gdG8gYXZvaWQgc2V0dGluZyBmb2N1cyBhZ2FpbiBhZnRlciBzZWxlY3Rpb24/IHVzZWZ1bCBmb3IgY2xlYW51cC1vbi1mb2N1cwogICAgICAgICAgICBpbnB1dC5mb2N1cygpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSkubW91c2Vkb3duKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBjb25maWcubW91c2VEb3duT25TZWxlY3QgPSB0cnVlOwogICAgICAgIH0pLm1vdXNldXAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGNvbmZpZy5tb3VzZURvd25PblNlbGVjdCA9IGZhbHNlOwogICAgICAgIH0pOwoKICAgICAgICBpZiggb3B0aW9ucy53aWR0aCA+IDAgKQogICAgICAgICAgICBlbGVtZW50LmNzcygid2lkdGgiLCBvcHRpb25zLndpZHRoKTsKCiAgICAgICAgbmVlZHNJbml0ID0gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gdGFyZ2V0KGV2ZW50KSB7CiAgICAgICAgdmFyIGVsZW1lbnQgPSBldmVudC50YXJnZXQ7CiAgICAgICAgd2hpbGUoZWxlbWVudCAmJiBlbGVtZW50LnRhZ05hbWUgIT0gIkxJIikKICAgICAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZTsKICAgICAgICAvLyBtb3JlIGZ1biB3aXRoIElFLCBzb21ldGltZXMgZXZlbnQudGFyZ2V0IGlzIGVtcHR5LCBqdXN0IGlnbm9yZSBpdCB0aGVuCiAgICAgICAgaWYoIWVsZW1lbnQpCiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICByZXR1cm4gZWxlbWVudDsKICAgIH0KCiAgICBmdW5jdGlvbiBtb3ZlU2VsZWN0KHN0ZXApIHsKICAgICAgICBsaXN0SXRlbXMuc2xpY2UoYWN0aXZlLCBhY3RpdmUgKyAxKS5yZW1vdmVDbGFzcyhDTEFTU0VTLkFDVElWRSk7CiAgICAgICAgbW92ZVBvc2l0aW9uKHN0ZXApOwogICAgICAgIHZhciBhY3RpdmVJdGVtID0gbGlzdEl0ZW1zLnNsaWNlKGFjdGl2ZSwgYWN0aXZlICsgMSkuYWRkQ2xhc3MoQ0xBU1NFUy5BQ1RJVkUpOwogICAgICAgIGlmKG9wdGlvbnMuc2Nyb2xsKSB7CiAgICAgICAgICAgIHZhciBvZmZzZXQgPSAwOwogICAgICAgICAgICBsaXN0SXRlbXMuc2xpY2UoMCwgYWN0aXZlKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgb2Zmc2V0ICs9IHRoaXMub2Zmc2V0SGVpZ2h0OwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYoKG9mZnNldCArIGFjdGl2ZUl0ZW1bMF0ub2Zmc2V0SGVpZ2h0IC0gbGlzdC5zY3JvbGxUb3AoKSkgPiBsaXN0WzBdLmNsaWVudEhlaWdodCkgewogICAgICAgICAgICAgICAgbGlzdC5zY3JvbGxUb3Aob2Zmc2V0ICsgYWN0aXZlSXRlbVswXS5vZmZzZXRIZWlnaHQgLSBsaXN0LmlubmVySGVpZ2h0KCkpOwogICAgICAgICAgICB9IGVsc2UgaWYob2Zmc2V0IDwgbGlzdC5zY3JvbGxUb3AoKSkgewogICAgICAgICAgICAgICAgbGlzdC5zY3JvbGxUb3Aob2Zmc2V0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CgogICAgZnVuY3Rpb24gbW92ZVBvc2l0aW9uKHN0ZXApIHsKICAgICAgICBhY3RpdmUgKz0gc3RlcDsKICAgICAgICBpZiAoYWN0aXZlIDwgMCkgewogICAgICAgICAgICBhY3RpdmUgPSBsaXN0SXRlbXMuc2l6ZSgpIC0gMTsKICAgICAgICB9IGVsc2UgaWYgKGFjdGl2ZSA+PSBsaXN0SXRlbXMuc2l6ZSgpKSB7CiAgICAgICAgICAgIGFjdGl2ZSA9IDA7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGxpbWl0TnVtYmVyT2ZJdGVtcyhhdmFpbGFibGUpIHsKICAgICAgICByZXR1cm4gb3B0aW9ucy5tYXggJiYgb3B0aW9ucy5tYXggPCBhdmFpbGFibGUKICAgICAgICAgICAgPyBvcHRpb25zLm1heAogICAgICAgICAgICA6IGF2YWlsYWJsZTsKICAgIH0KCiAgICBmdW5jdGlvbiBmaWxsTGlzdCgpIHsKICAgICAgICBsaXN0LmVtcHR5KCk7CiAgICAgICAgdmFyIG1heCA9IGxpbWl0TnVtYmVyT2ZJdGVtcyhkYXRhLmxlbmd0aCk7CiAgICAgICAgZm9yICh2YXIgaT0wOyBpIDwgbWF4OyBpKyspIHsKICAgICAgICAgICAgaWYgKCFkYXRhW2ldKQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIHZhciBmb3JtYXR0ZWQgPSBvcHRpb25zLmZvcm1hdEl0ZW0oZGF0YVtpXS5kYXRhLCBpKzEsIG1heCwgZGF0YVtpXS52YWx1ZSwgdGVybSk7CiAgICAgICAgICAgIGlmICggZm9ybWF0dGVkID09PSBmYWxzZSApCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgdmFyIGxpID0gJCgiPGxpLz4iKS5odG1sKCBvcHRpb25zLmhpZ2hsaWdodChmb3JtYXR0ZWQsIHRlcm0pICkuYWRkQ2xhc3MoaSUyID09IDAgPyAiYWNfZXZlbiIgOiAiYWNfb2RkIikuYXBwZW5kVG8obGlzdClbMF07CiAgICAgICAgICAgICQuZGF0YShsaSwgImFjX2RhdGEiLCBkYXRhW2ldKTsKICAgICAgICB9CiAgICAgICAgbGlzdEl0ZW1zID0gbGlzdC5maW5kKCJsaSIpOwogICAgICAgIGlmICggb3B0aW9ucy5zZWxlY3RGaXJzdCApIHsKICAgICAgICAgICAgbGlzdEl0ZW1zLnNsaWNlKDAsIDEpLmFkZENsYXNzKENMQVNTRVMuQUNUSVZFKTsKICAgICAgICAgICAgYWN0aXZlID0gMDsKICAgICAgICB9CiAgICAgICAgLy8gYXBwbHkgYmdpZnJhbWUgaWYgYXZhaWxhYmxlCiAgICAgICAgaWYgKCAkLmZuLmJnaWZyYW1lICkKICAgICAgICAgICAgbGlzdC5iZ2lmcmFtZSgpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgZGlzcGxheTogZnVuY3Rpb24oZCwgcSkgewogICAgICAgICAgICBpbml0KCk7CiAgICAgICAgICAgIGRhdGEgPSBkOwogICAgICAgICAgICB0ZXJtID0gcTsKICAgICAgICAgICAgZmlsbExpc3QoKTsKICAgICAgICB9LAogICAgICAgIG5leHQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBtb3ZlU2VsZWN0KDEpOwogICAgICAgIH0sCiAgICAgICAgcHJldjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIG1vdmVTZWxlY3QoLTEpOwogICAgICAgIH0sCiAgICAgICAgcGFnZVVwOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKGFjdGl2ZSAhPSAwICYmIGFjdGl2ZSAtIDggPCAwKSB7CiAgICAgICAgICAgICAgICBtb3ZlU2VsZWN0KCAtYWN0aXZlICk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtb3ZlU2VsZWN0KC04KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcGFnZURvd246IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoYWN0aXZlICE9IGxpc3RJdGVtcy5zaXplKCkgLSAxICYmIGFjdGl2ZSArIDggPiBsaXN0SXRlbXMuc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICBtb3ZlU2VsZWN0KCBsaXN0SXRlbXMuc2l6ZSgpIC0gMSAtIGFjdGl2ZSApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbW92ZVNlbGVjdCg4KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaGlkZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGVsZW1lbnQgJiYgZWxlbWVudC5oaWRlKCk7CiAgICAgICAgICAgIGxpc3RJdGVtcyAmJiBsaXN0SXRlbXMucmVtb3ZlQ2xhc3MoQ0xBU1NFUy5BQ1RJVkUpOwogICAgICAgICAgICBhY3RpdmUgPSAtMTsKICAgICAgICB9LAogICAgICAgIHZpc2libGUgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQgJiYgZWxlbWVudC5pcygiOnZpc2libGUiKTsKICAgICAgICB9LAogICAgICAgIGN1cnJlbnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy52aXNpYmxlKCkgJiYgKGxpc3RJdGVtcy5maWx0ZXIoIi4iICsgQ0xBU1NFUy5BQ1RJVkUpWzBdIHx8IG9wdGlvbnMuc2VsZWN0Rmlyc3QgJiYgbGlzdEl0ZW1zWzBdKTsKICAgICAgICB9LAogICAgICAgIHNob3c6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgb2Zmc2V0ID0gJChpbnB1dCkub2Zmc2V0KCk7CiAgICAgICAgICAgIGVsZW1lbnQuY3NzKHsKICAgICAgICAgICAgICAgIHdpZHRoOiB0eXBlb2Ygb3B0aW9ucy53aWR0aCA9PSAic3RyaW5nIiB8fCBvcHRpb25zLndpZHRoID4gMCA/IG9wdGlvbnMud2lkdGggOiAkKGlucHV0KS53aWR0aCgpLAogICAgICAgICAgICAgICAgdG9wOiBvZmZzZXQudG9wICsgaW5wdXQub2Zmc2V0SGVpZ2h0LAogICAgICAgICAgICAgICAgbGVmdDogb2Zmc2V0LmxlZnQKICAgICAgICAgICAgfSkuc2hvdygpOwogICAgICAgICAgICBpZihvcHRpb25zLnNjcm9sbCkgewogICAgICAgICAgICAgICAgbGlzdC5zY3JvbGxUb3AoMCk7CiAgICAgICAgICAgICAgICBsaXN0LmNzcyh7CiAgICAgICAgICAgICAgICAgICAgbWF4SGVpZ2h0OiBvcHRpb25zLnNjcm9sbEhlaWdodCwKICAgICAgICAgICAgICAgICAgICBvdmVyZmxvdzogJ2F1dG8nCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZigkLmJyb3dzZXIubXNpZSAmJiB0eXBlb2YgZG9jdW1lbnQuYm9keS5zdHlsZS5tYXhIZWlnaHQgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGxpc3RIZWlnaHQgPSAwOwogICAgICAgICAgICAgICAgICAgIGxpc3RJdGVtcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBsaXN0SGVpZ2h0ICs9IHRoaXMub2Zmc2V0SGVpZ2h0OwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHZhciBzY3JvbGxiYXJzVmlzaWJsZSA9IGxpc3RIZWlnaHQgPiBvcHRpb25zLnNjcm9sbEhlaWdodDsKICAgICAgICAgICAgICAgICAgICBsaXN0LmNzcygnaGVpZ2h0Jywgc2Nyb2xsYmFyc1Zpc2libGUgPyBvcHRpb25zLnNjcm9sbEhlaWdodCA6IGxpc3RIZWlnaHQgKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXNjcm9sbGJhcnNWaXNpYmxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElFIGRvZXNuJ3QgcmVjYWxjdWxhdGUgd2lkdGggd2hlbiBzY3JvbGxiYXIgZGlzYXBwZWFycwogICAgICAgICAgICAgICAgICAgICAgICBsaXN0SXRlbXMud2lkdGgoIGxpc3Qud2lkdGgoKSAtIHBhcnNlSW50KGxpc3RJdGVtcy5jc3MoInBhZGRpbmctbGVmdCIpKSAtIHBhcnNlSW50KGxpc3RJdGVtcy5jc3MoInBhZGRpbmctcmlnaHQiKSkgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzZWxlY3RlZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxlY3RlZCA9IGxpc3RJdGVtcyAmJiBsaXN0SXRlbXMuZmlsdGVyKCIuIiArIENMQVNTRVMuQUNUSVZFKS5yZW1vdmVDbGFzcyhDTEFTU0VTLkFDVElWRSk7CiAgICAgICAgICAgIHJldHVybiBzZWxlY3RlZCAmJiBzZWxlY3RlZC5sZW5ndGggJiYgJC5kYXRhKHNlbGVjdGVkWzBdLCAiYWNfZGF0YSIpOwogICAgICAgIH0sCiAgICAgICAgZW1wdHlMaXN0OiBmdW5jdGlvbiAoKXsKICAgICAgICAgICAgbGlzdCAmJiBsaXN0LmVtcHR5KCk7CiAgICAgICAgfSwKICAgICAgICB1bmJpbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBlbGVtZW50ICYmIGVsZW1lbnQucmVtb3ZlKCk7CiAgICAgICAgfQogICAgfTsKfTsKCiQuZm4uc2VsZWN0aW9uID0gZnVuY3Rpb24oc3RhcnQsIGVuZCkgewogICAgaWYgKHN0YXJ0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiggdGhpcy5jcmVhdGVUZXh0UmFuZ2UgKXsKICAgICAgICAgICAgICAgIHZhciBzZWxSYW5nZSA9IHRoaXMuY3JlYXRlVGV4dFJhbmdlKCk7CiAgICAgICAgICAgICAgICBpZiAoZW5kID09PSB1bmRlZmluZWQgfHwgc3RhcnQgPT0gZW5kKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsUmFuZ2UubW92ZSgiY2hhcmFjdGVyIiwgc3RhcnQpOwogICAgICAgICAgICAgICAgICAgIHNlbFJhbmdlLnNlbGVjdCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzZWxSYW5nZS5jb2xsYXBzZSh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBzZWxSYW5nZS5tb3ZlU3RhcnQoImNoYXJhY3RlciIsIHN0YXJ0KTsKICAgICAgICAgICAgICAgICAgICBzZWxSYW5nZS5tb3ZlRW5kKCJjaGFyYWN0ZXIiLCBlbmQpOwogICAgICAgICAgICAgICAgICAgIHNlbFJhbmdlLnNlbGVjdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYoIHRoaXMuc2V0U2VsZWN0aW9uUmFuZ2UgKXsKICAgICAgICAgICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uUmFuZ2Uoc3RhcnQsIGVuZCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiggdGhpcy5zZWxlY3Rpb25TdGFydCApewogICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25TdGFydCA9IHN0YXJ0OwogICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25FbmQgPSBlbmQ7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgIHZhciBmaWVsZCA9IHRoaXNbMF07CiAgICBpZiAoIGZpZWxkLmNyZWF0ZVRleHRSYW5nZSApIHsKICAgICAgICB2YXIgcmFuZ2UgPSBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKSwKICAgICAgICAgICAgb3JpZyA9IGZpZWxkLnZhbHVlLAogICAgICAgICAgICB0ZXN0c3RyaW5nID0gIjwtPiIsCiAgICAgICAgICAgIHRleHRMZW5ndGggPSByYW5nZS50ZXh0Lmxlbmd0aDsKICAgICAgICByYW5nZS50ZXh0ID0gdGVzdHN0cmluZzsKICAgICAgICB2YXIgY2FyZXRBdCA9IGZpZWxkLnZhbHVlLmluZGV4T2YodGVzdHN0cmluZyk7CiAgICAgICAgZmllbGQudmFsdWUgPSBvcmlnOwogICAgICAgIHRoaXMuc2VsZWN0aW9uKGNhcmV0QXQsIGNhcmV0QXQgKyB0ZXh0TGVuZ3RoKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzdGFydDogY2FyZXRBdCwKICAgICAgICAgICAgZW5kOiBjYXJldEF0ICsgdGV4dExlbmd0aAogICAgICAgIH0KICAgIH0gZWxzZSBpZiggZmllbGQuc2VsZWN0aW9uU3RhcnQgIT09IHVuZGVmaW5lZCApewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHN0YXJ0OiBmaWVsZC5zZWxlY3Rpb25TdGFydCwKICAgICAgICAgICAgZW5kOiBmaWVsZC5zZWxlY3Rpb25FbmQKICAgICAgICB9CiAgICB9Cn07Cgp9KShqUXVlcnkpOw==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>