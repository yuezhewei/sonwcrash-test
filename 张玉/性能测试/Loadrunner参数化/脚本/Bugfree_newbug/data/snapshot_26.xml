<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="26">
  <HTTPTask id="67" hostname="192.168.109.1" path="/bugfree/themes/classic/assets/js/jquery.form.js" url="http://192.168.109.1:8032/bugfree/themes/classic/assets/js/jquery.form.js" ip="192.168.109.1" port="8032" connectionId="14" origin="Primary" frame="1" startTime="1070307" endTime="1070322">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Accept" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cDovLzE5Mi4xNjguMTA5LjE6ODAzMi9idWdmcmVlL2luZGV4LnBocC9idWcvbGlzdC8x</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>emgtQ04=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS80LjAgKGNvbXBhdGlibGU7IE1TSUUgOC4wOyBXaW5kb3dzIE5UIDYuMTsgV09XNjQ7IFRyaWRlbnQvNC4wOyBTTENDMjsgLk5FVCBDTFIgMi4wLjUwNzI3OyAuTkVUIENMUiAzLjUuMzA3Mjk7IC5ORVQgQ0xSIDMuMC4zMDcyOSk=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Host" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MTkyLjE2OC4xMDkuMTo4MDMy</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>S2VlcC1BbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MV9wcm9kdWN0PTdjNzBkOGJhYmY2YzI2MjIyODliZGRkMmQyMDk3YzJkODkwNjg2N2NzJTNBMSUzQSUyMjElMjIlM0I7IHBhZ2VTaXplPTJkZDdiNGIyNjBmMTUxM2E3M2I4NWI1MTExNGZiNTNlZjNkOGQwNTZzJTNBMiUzQSUyMjIwJTIyJTNCOyBhYy1jb29raWU9JTVCJTdCJTIyZGF0YSUyMiUzQSU1QiUyMiU1Q3U3Y2ZiJTVDdTdlZGYlNUN1N2JhMSU1Q3U3NDA2JTVDdTU0NTglMjIlMkMlMjIlNUN1N2NmYiU1Q3U3ZWRmJTVDdTdiYTElNUN1NzQwNiU1Q3U1NDU4JTVCYWRtaW4lNUQlMjIlNUQlMkMlMjJ2YWx1ZSUyMiUzQSUyMiU1Q3U3Y2ZiJTVDdTdlZGYlNUN1N2JhMSU1Q3U3NDA2JTVDdTU0NTglMjIlMkMlMjJyZXN1bHQlMjIlM0ElMjIlNUN1N2NmYiU1Q3U3ZWRmJTVDdTdiYTElNUN1NzQwNiU1Q3U1NDU4JTIyJTdEJTVEOyBQSFBTRVNTSUQ9Z2x2NThnajFnbXBxZmhwMGwwZ3NjZm9mbjc7IGxhbmd1YWdlPTMzMTQyMTkxYzhhODk1YjUwOWNhMmZiNmY2Y2M1OTdhMzEyNWYxNThzJTNBNSUzQSUyMnpoX2NuJTIyJTNC</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9idWdmcmVlL3RoZW1lcy9jbGFzc2ljL2Fzc2V0cy9qcy9qcXVlcnkuZm9ybS5qcyBIVFRQLzEuMQ0KQWNjZXB0OiAqLyoNClJlZmVyZXI6IGh0dHA6Ly8xOTIuMTY4LjEwOS4xOjgwMzIvYnVnZnJlZS9pbmRleC5waHAvYnVnL2xpc3QvMQ0KQWNjZXB0LUxhbmd1YWdlOiB6aC1DTg0KVXNlci1BZ2VudDogTW96aWxsYS80LjAgKGNvbXBhdGlibGU7IE1TSUUgOC4wOyBXaW5kb3dzIE5UIDYuMTsgV09XNjQ7IFRyaWRlbnQvNC4wOyBTTENDMjsgLk5FVCBDTFIgMi4wLjUwNzI3OyAuTkVUIENMUiAzLjUuMzA3Mjk7IC5ORVQgQ0xSIDMuMC4zMDcyOSkNCkFjY2VwdC1FbmNvZGluZzogZ3ppcCwgZGVmbGF0ZQ0KSG9zdDogMTkyLjE2OC4xMDkuMTo4MDMyDQpDb25uZWN0aW9uOiBLZWVwLUFsaXZlDQpDb29raWU6IDFfcHJvZHVjdD03YzcwZDhiYWJmNmMyNjIyMjg5YmRkZDJkMjA5N2MyZDg5MDY4NjdjcyUzQTElM0ElMjIxJTIyJTNCOyBwYWdlU2l6ZT0yZGQ3YjRiMjYwZjE1MTNhNzNiODViNTExMTRmYjUzZWYzZDhkMDU2cyUzQTIlM0ElMjIyMCUyMiUzQjsgYWMtY29va2llPSU1QiU3QiUyMmRhdGElMjIlM0ElNUIlMjIlNUN1N2NmYiU1Q3U3ZWRmJTVDdTdiYTElNUN1NzQwNiU1Q3U1NDU4JTIyJTJDJTIyJTVDdTdjZmIlNUN1N2VkZiU1Q3U3YmExJTVDdTc0MDYlNUN1NTQ1OCU1QmFkbWluJTVEJTIyJTVEJTJDJTIydmFsdWUlMjIlM0ElMjIlNUN1N2NmYiU1Q3U3ZWRmJTVDdTdiYTElNUN1NzQwNiU1Q3U1NDU4JTIyJTJDJTIycmVzdWx0JTIyJTNBJTIyJTVDdTdjZmIlNUN1N2VkZiU1Q3U3YmExJTVDdTc0MDYlNUN1NTQ1OCUyMiU3RCU1RDsgUEhQU0VTU0lEPWdsdjU4Z2oxZ21wcWZocDBsMGdzY2ZvZm43OyBsYW5ndWFnZT0zMzE0MjE5MWM4YTg5NWI1MDljYTJmYjZmNmNjNTk3YTMxMjVmMTU4cyUzQTUlM0ElMjJ6aF9jbiUyMiUzQg0KDQo=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="1_product" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>N2M3MGQ4YmFiZjZjMjYyMjI4OWJkZGQyZDIwOTdjMmQ4OTA2ODY3Y3MlM0ExJTNBJTIyMSUyMiUzQg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="pageSize" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MmRkN2I0YjI2MGYxNTEzYTczYjg1YjUxMTE0ZmI1M2VmM2Q4ZDA1NnMlM0EyJTNBJTIyMjAlMjIlM0I=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ac-cookie" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>JTVCJTdCJTIyZGF0YSUyMiUzQSU1QiUyMiU1Q3U3Y2ZiJTVDdTdlZGYlNUN1N2JhMSU1Q3U3NDA2JTVDdTU0NTglMjIlMkMlMjIlNUN1N2NmYiU1Q3U3ZWRmJTVDdTdiYTElNUN1NzQwNiU1Q3U1NDU4JTVCYWRtaW4lNUQlMjIlNUQlMkMlMjJ2YWx1ZSUyMiUzQSUyMiU1Q3U3Y2ZiJTVDdTdlZGYlNUN1N2JhMSU1Q3U3NDA2JTVDdTU0NTglMjIlMkMlMjJyZXN1bHQlMjIlM0ElMjIlNUN1N2NmYiU1Q3U3ZWRmJTVDdTdiYTElNUN1NzQwNiU1Q3U1NDU4JTIyJTdEJTVE</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="PHPSESSID" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Z2x2NThnajFnbXBxZmhwMGwwZ3NjZm9mbjc=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="language" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MzMxNDIxOTFjOGE4OTViNTA5Y2EyZmI2ZjZjYzU5N2EzMTI1ZjE1OHMlM0E1JTNBJTIyemhfY24lMjIlM0I=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Date" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW9uLCAyNyBNYXkgMjAxOSAwNjoyMDozMSBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Server" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QXBhY2hlLzIuNC42IChXaW4zMikgUEhQLzUuNS4x</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Last-Modified" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>V2VkLCAxOCBKdWwgMjAxMiAwNjoyMzo0OCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>IjY4N2YtNGM1MTRiNGFiODUwMC1nemlwIg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Ranges" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ynl0ZXM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Length" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>OTEwOA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Keep-Alive" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dGltZW91dD01LCBtYXg9OTY=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>S2VlcC1BbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="10">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YXBwbGljYXRpb24vamF2YXNjcmlwdA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIE9LDQpEYXRlOiBNb24sIDI3IE1heSAyMDE5IDA2OjIwOjMxIEdNVA0KU2VydmVyOiBBcGFjaGUvMi40LjYgKFdpbjMyKSBQSFAvNS41LjENCkxhc3QtTW9kaWZpZWQ6IFdlZCwgMTggSnVsIDIwMTIgMDY6MjM6NDggR01UDQpFVGFnOiAiNjg3Zi00YzUxNGI0YWI4NTAwLWd6aXAiDQpBY2NlcHQtUmFuZ2VzOiBieXRlcw0KVmFyeTogQWNjZXB0LUVuY29kaW5nDQpDb250ZW50LUVuY29kaW5nOiBnemlwDQpDb250ZW50LUxlbmd0aDogOTEwOA0KS2VlcC1BbGl2ZTogdGltZW91dD01LCBtYXg9OTYNCkNvbm5lY3Rpb246IEtlZXAtQWxpdmUNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KDQo=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>LyohCiAqIGpRdWVyeSBGb3JtIFBsdWdpbgogKiB2ZXJzaW9uOiAyLjg0ICgxMi1BVUctMjAxMSkKICogQHJlcXVpcmVzIGpRdWVyeSB2MS4zLjIgb3IgbGF0ZXIKICoKICogRXhhbXBsZXMgYW5kIGRvY3VtZW50YXRpb24gYXQ6IGh0dHA6Ly9tYWxzdXAuY29tL2pxdWVyeS9mb3JtLwogKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgYW5kIEdQTCBsaWNlbnNlczoKICogICBodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLnBocAogKiAgIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9ncGwuaHRtbAogKi8KOyhmdW5jdGlvbigkKSB7CgovKgoJVXNhZ2UgTm90ZToKCS0tLS0tLS0tLS0tCglEbyBub3QgdXNlIGJvdGggYWpheFN1Ym1pdCBhbmQgYWpheEZvcm0gb24gdGhlIHNhbWUgZm9ybS4gIFRoZXNlCglmdW5jdGlvbnMgYXJlIGludGVuZGVkIHRvIGJlIGV4Y2x1c2l2ZS4gIFVzZSBhamF4U3VibWl0IGlmIHlvdSB3YW50Cgl0byBiaW5kIHlvdXIgb3duIHN1Ym1pdCBoYW5kbGVyIHRvIHRoZSBmb3JtLiAgRm9yIGV4YW1wbGUsCgoJJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJJCgnI215Rm9ybScpLmJpbmQoJ3N1Ym1pdCcsIGZ1bmN0aW9uKGUpIHsKCQkJZS5wcmV2ZW50RGVmYXVsdCgpOyAvLyA8LS0gaW1wb3J0YW50CgkJCSQodGhpcykuYWpheFN1Ym1pdCh7CgkJCQl0YXJnZXQ6ICcjb3V0cHV0JwoJCQl9KTsKCQl9KTsKCX0pOwoKCVVzZSBhamF4Rm9ybSB3aGVuIHlvdSB3YW50IHRoZSBwbHVnaW4gdG8gbWFuYWdlIGFsbCB0aGUgZXZlbnQgYmluZGluZwoJZm9yIHlvdS4gIEZvciBleGFtcGxlLAoKCSQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSQoJyNteUZvcm0nKS5hamF4Rm9ybSh7CgkJCXRhcmdldDogJyNvdXRwdXQnCgkJfSk7Cgl9KTsKCglXaGVuIHVzaW5nIGFqYXhGb3JtLCB0aGUgYWpheFN1Ym1pdCBmdW5jdGlvbiB3aWxsIGJlIGludm9rZWQgZm9yIHlvdQoJYXQgdGhlIGFwcHJvcHJpYXRlIHRpbWUuCiovCgovKioKICogYWpheFN1Ym1pdCgpIHByb3ZpZGVzIGEgbWVjaGFuaXNtIGZvciBpbW1lZGlhdGVseSBzdWJtaXR0aW5nCiAqIGFuIEhUTUwgZm9ybSB1c2luZyBBSkFYLgogKi8KJC5mbi5hamF4U3VibWl0ID0gZnVuY3Rpb24ob3B0aW9ucykgewoJLy8gZmFzdCBmYWlsIGlmIG5vdGhpbmcgc2VsZWN0ZWQgKGh0dHA6Ly9kZXYuanF1ZXJ5LmNvbS90aWNrZXQvMjc1MikKCWlmICghdGhpcy5sZW5ndGgpIHsKCQlsb2coJ2FqYXhTdWJtaXQ6IHNraXBwaW5nIHN1Ym1pdCBwcm9jZXNzIC0gbm8gZWxlbWVudCBzZWxlY3RlZCcpOwoJCXJldHVybiB0aGlzOwoJfQoJCgl2YXIgbWV0aG9kLCBhY3Rpb24sIHVybCwgJGZvcm0gPSB0aGlzOwoKCWlmICh0eXBlb2Ygb3B0aW9ucyA9PSAnZnVuY3Rpb24nKSB7CgkJb3B0aW9ucyA9IHsgc3VjY2Vzczogb3B0aW9ucyB9OwoJfQoKCW1ldGhvZCA9IHRoaXMuYXR0cignbWV0aG9kJyk7CglhY3Rpb24gPSB0aGlzLmF0dHIoJ2FjdGlvbicpOwoJdXJsID0gKHR5cGVvZiBhY3Rpb24gPT09ICdzdHJpbmcnKSA/ICQudHJpbShhY3Rpb24pIDogJyc7Cgl1cmwgPSB1cmwgfHwgd2luZG93LmxvY2F0aW9uLmhyZWYgfHwgJyc7CglpZiAodXJsKSB7CgkJLy8gY2xlYW4gdXJsIChkb24ndCBpbmNsdWRlIGhhc2ggdmF1ZSkKCQl1cmwgPSAodXJsLm1hdGNoKC9eKFteI10rKS8pfHxbXSlbMV07Cgl9CgoJb3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHsKCQl1cmw6ICB1cmwsCgkJc3VjY2VzczogJC5hamF4U2V0dGluZ3Muc3VjY2VzcywKCQl0eXBlOiBtZXRob2QgfHwgJ0dFVCcsCgkJaWZyYW1lU3JjOiAvXmh0dHBzL2kudGVzdCh3aW5kb3cubG9jYXRpb24uaHJlZiB8fCAnJykgPyAnamF2YXNjcmlwdDpmYWxzZScgOiAnYWJvdXQ6YmxhbmsnCgl9LCBvcHRpb25zKTsKCgkvLyBob29rIGZvciBtYW5pcHVsYXRpbmcgdGhlIGZvcm0gZGF0YSBiZWZvcmUgaXQgaXMgZXh0cmFjdGVkOwoJLy8gY29udmVuaWVudCBmb3IgdXNlIHdpdGggcmljaCBlZGl0b3JzIGxpa2UgdGlueU1DRSBvciBGQ0tFZGl0b3IKCXZhciB2ZXRvID0ge307Cgl0aGlzLnRyaWdnZXIoJ2Zvcm0tcHJlLXNlcmlhbGl6ZScsIFt0aGlzLCBvcHRpb25zLCB2ZXRvXSk7CglpZiAodmV0by52ZXRvKSB7CgkJbG9nKCdhamF4U3VibWl0OiBzdWJtaXQgdmV0b2VkIHZpYSBmb3JtLXByZS1zZXJpYWxpemUgdHJpZ2dlcicpOwoJCXJldHVybiB0aGlzOwoJfQoKCS8vIHByb3ZpZGUgb3Bwb3J0dW5pdHkgdG8gYWx0ZXIgZm9ybSBkYXRhIGJlZm9yZSBpdCBpcyBzZXJpYWxpemVkCglpZiAob3B0aW9ucy5iZWZvcmVTZXJpYWxpemUgJiYgb3B0aW9ucy5iZWZvcmVTZXJpYWxpemUodGhpcywgb3B0aW9ucykgPT09IGZhbHNlKSB7CgkJbG9nKCdhamF4U3VibWl0OiBzdWJtaXQgYWJvcnRlZCB2aWEgYmVmb3JlU2VyaWFsaXplIGNhbGxiYWNrJyk7CgkJcmV0dXJuIHRoaXM7Cgl9CgoJdmFyIG4sdixhID0gdGhpcy5mb3JtVG9BcnJheShvcHRpb25zLnNlbWFudGljKTsKCWlmIChvcHRpb25zLmRhdGEpIHsKCQlvcHRpb25zLmV4dHJhRGF0YSA9IG9wdGlvbnMuZGF0YTsKCQlmb3IgKG4gaW4gb3B0aW9ucy5kYXRhKSB7CgkJCWlmKCAkLmlzQXJyYXkob3B0aW9ucy5kYXRhW25dKSApIHsKCQkJCWZvciAodmFyIGsgaW4gb3B0aW9ucy5kYXRhW25dKSB7CgkJCQkJYS5wdXNoKCB7IG5hbWU6IG4sIHZhbHVlOiBvcHRpb25zLmRhdGFbbl1ba10gfSApOwoJCQkJfQoJCQl9CgkJCWVsc2UgewoJCQkJdiA9IG9wdGlvbnMuZGF0YVtuXTsKCQkJCXYgPSAkLmlzRnVuY3Rpb24odikgPyB2KCkgOiB2OyAvLyBpZiB2YWx1ZSBpcyBmbiwgaW52b2tlIGl0CgkJCQlhLnB1c2goIHsgbmFtZTogbiwgdmFsdWU6IHYgfSApOwoJCQl9CgkJfQoJfQoKCS8vIGdpdmUgcHJlLXN1Ym1pdCBjYWxsYmFjayBhbiBvcHBvcnR1bml0eSB0byBhYm9ydCB0aGUgc3VibWl0CglpZiAob3B0aW9ucy5iZWZvcmVTdWJtaXQgJiYgb3B0aW9ucy5iZWZvcmVTdWJtaXQoYSwgdGhpcywgb3B0aW9ucykgPT09IGZhbHNlKSB7CgkJbG9nKCdhamF4U3VibWl0OiBzdWJtaXQgYWJvcnRlZCB2aWEgYmVmb3JlU3VibWl0IGNhbGxiYWNrJyk7CgkJcmV0dXJuIHRoaXM7Cgl9CgoJLy8gZmlyZSB2ZXRvYWJsZSAndmFsaWRhdGUnIGV2ZW50Cgl0aGlzLnRyaWdnZXIoJ2Zvcm0tc3VibWl0LXZhbGlkYXRlJywgW2EsIHRoaXMsIG9wdGlvbnMsIHZldG9dKTsKCWlmICh2ZXRvLnZldG8pIHsKCQlsb2coJ2FqYXhTdWJtaXQ6IHN1Ym1pdCB2ZXRvZWQgdmlhIGZvcm0tc3VibWl0LXZhbGlkYXRlIHRyaWdnZXInKTsKCQlyZXR1cm4gdGhpczsKCX0KCgl2YXIgcSA9ICQucGFyYW0oYSk7CgoJaWYgKG9wdGlvbnMudHlwZS50b1VwcGVyQ2FzZSgpID09ICdHRVQnKSB7CgkJb3B0aW9ucy51cmwgKz0gKG9wdGlvbnMudXJsLmluZGV4T2YoJz8nKSA+PSAwID8gJyYnIDogJz8nKSArIHE7CgkJb3B0aW9ucy5kYXRhID0gbnVsbDsgIC8vIGRhdGEgaXMgbnVsbCBmb3IgJ2dldCcKCX0KCWVsc2UgewoJCW9wdGlvbnMuZGF0YSA9IHE7IC8vIGRhdGEgaXMgdGhlIHF1ZXJ5IHN0cmluZyBmb3IgJ3Bvc3QnCgl9CgoJdmFyIGNhbGxiYWNrcyA9IFtdOwoJaWYgKG9wdGlvbnMucmVzZXRGb3JtKSB7CgkJY2FsbGJhY2tzLnB1c2goZnVuY3Rpb24oKSB7ICRmb3JtLnJlc2V0Rm9ybSgpOyB9KTsKCX0KCWlmIChvcHRpb25zLmNsZWFyRm9ybSkgewoJCWNhbGxiYWNrcy5wdXNoKGZ1bmN0aW9uKCkgeyAkZm9ybS5jbGVhckZvcm0oKTsgfSk7Cgl9CgoJLy8gcGVyZm9ybSBhIGxvYWQgb24gdGhlIHRhcmdldCBvbmx5IGlmIGRhdGFUeXBlIGlzIG5vdCBwcm92aWRlZAoJaWYgKCFvcHRpb25zLmRhdGFUeXBlICYmIG9wdGlvbnMudGFyZ2V0KSB7CgkJdmFyIG9sZFN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3MgfHwgZnVuY3Rpb24oKXt9OwoJCWNhbGxiYWNrcy5wdXNoKGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFyIGZuID0gb3B0aW9ucy5yZXBsYWNlVGFyZ2V0ID8gJ3JlcGxhY2VXaXRoJyA6ICdodG1sJzsKCQkJJChvcHRpb25zLnRhcmdldClbZm5dKGRhdGEpLmVhY2gob2xkU3VjY2VzcywgYXJndW1lbnRzKTsKCQl9KTsKCX0KCWVsc2UgaWYgKG9wdGlvbnMuc3VjY2VzcykgewoJCWNhbGxiYWNrcy5wdXNoKG9wdGlvbnMuc3VjY2Vzcyk7Cgl9CgoJb3B0aW9ucy5zdWNjZXNzID0gZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCB4aHIpIHsgLy8galF1ZXJ5IDEuNCsgcGFzc2VzIHhociBhcyAzcmQgYXJnCgkJdmFyIGNvbnRleHQgPSBvcHRpb25zLmNvbnRleHQgfHwgb3B0aW9uczsgICAvLyBqUXVlcnkgMS40KyBzdXBwb3J0cyBzY29wZSBjb250ZXh0IAoJCWZvciAodmFyIGk9MCwgbWF4PWNhbGxiYWNrcy5sZW5ndGg7IGkgPCBtYXg7IGkrKykgewoJCQljYWxsYmFja3NbaV0uYXBwbHkoY29udGV4dCwgW2RhdGEsIHN0YXR1cywgeGhyIHx8ICRmb3JtLCAkZm9ybV0pOwoJCX0KCX07CgoJLy8gYXJlIHRoZXJlIGZpbGVzIHRvIHVwbG9hZD8KCXZhciBmaWxlSW5wdXRzID0gJCgnaW5wdXQ6ZmlsZScsIHRoaXMpLmxlbmd0aCA+IDA7Cgl2YXIgbXAgPSAnbXVsdGlwYXJ0L2Zvcm0tZGF0YSc7Cgl2YXIgbXVsdGlwYXJ0ID0gKCRmb3JtLmF0dHIoJ2VuY3R5cGUnKSA9PSBtcCB8fCAkZm9ybS5hdHRyKCdlbmNvZGluZycpID09IG1wKTsKCgkvLyBvcHRpb25zLmlmcmFtZSBhbGxvd3MgdXNlciB0byBmb3JjZSBpZnJhbWUgbW9kZQoJLy8gMDYtTk9WLTA5OiBub3cgZGVmYXVsdGluZyB0byBpZnJhbWUgbW9kZSBpZiBmaWxlIGlucHV0IGlzIGRldGVjdGVkCiAgIGlmIChvcHRpb25zLmlmcmFtZSAhPT0gZmFsc2UgJiYgKGZpbGVJbnB1dHMgfHwgb3B0aW9ucy5pZnJhbWUgfHwgbXVsdGlwYXJ0KSkgewoJICAgLy8gaGFjayB0byBmaXggU2FmYXJpIGhhbmcgKHRoYW5rcyB0byBUaW0gTW9sZW5kaWprIGZvciB0aGlzKQoJICAgLy8gc2VlOiAgaHR0cDovL2dyb3Vwcy5nb29nbGUuY29tL2dyb3VwL2pxdWVyeS1kZXYvYnJvd3NlX3RocmVhZC90aHJlYWQvMzYzOTViN2FiNTEwZGQ1ZAoJICAgaWYgKG9wdGlvbnMuY2xvc2VLZWVwQWxpdmUpIHsKCQkgICAkLmdldChvcHRpb25zLmNsb3NlS2VlcEFsaXZlLCBmdW5jdGlvbigpIHsgZmlsZVVwbG9hZChhKTsgfSk7CgkJfQoJICAgZWxzZSB7CgkJICAgZmlsZVVwbG9hZChhKTsKCQl9CiAgIH0KICAgZWxzZSB7CgkJLy8gSUU3IG1hc3NhZ2UgKHNlZSBpc3N1ZSA1NykKCQlpZiAoJC5icm93c2VyLm1zaWUgJiYgbWV0aG9kID09ICdnZXQnKSB7IAoJCQl2YXIgaWVNZXRoID0gJGZvcm1bMF0uZ2V0QXR0cmlidXRlKCdtZXRob2QnKTsKCQkJaWYgKHR5cGVvZiBpZU1ldGggPT09ICdzdHJpbmcnKQoJCQkJb3B0aW9ucy50eXBlID0gaWVNZXRoOwoJCX0KCQkkLmFqYXgob3B0aW9ucyk7CiAgIH0KCgkvLyBmaXJlICdub3RpZnknIGV2ZW50Cgl0aGlzLnRyaWdnZXIoJ2Zvcm0tc3VibWl0LW5vdGlmeScsIFt0aGlzLCBvcHRpb25zXSk7CglyZXR1cm4gdGhpczsKCgoJLy8gcHJpdmF0ZSBmdW5jdGlvbiBmb3IgaGFuZGxpbmcgZmlsZSB1cGxvYWRzIChoYXQgdGlwIHRvIFlBSE9PISkKCWZ1bmN0aW9uIGZpbGVVcGxvYWQoYSkgewoJCXZhciBmb3JtID0gJGZvcm1bMF0sIGVsLCBpLCBzLCBnLCBpZCwgJGlvLCBpbywgeGhyLCBzdWIsIG4sIHRpbWVkT3V0LCB0aW1lb3V0SGFuZGxlOwogICAgICAgIHZhciB1c2VQcm9wID0gISEkLmZuLnByb3A7CgogICAgICAgIGlmIChhKSB7CiAgICAgICAgCS8vIGVuc3VyZSB0aGF0IGV2ZXJ5IHNlcmlhbGl6ZWQgaW5wdXQgaXMgc3RpbGwgZW5hYmxlZAogICAgICAgICAgCWZvciAoaT0wOyBpIDwgYS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgZWwgPSAkKGZvcm1bYVtpXS5uYW1lXSk7CiAgICAgICAgICAgICAgICBlbFsgdXNlUHJvcCA/ICdwcm9wJyA6ICdhdHRyJyBdKCdkaXNhYmxlZCcsIGZhbHNlKTsKICAgICAgICAgIAl9CiAgICAgICAgfQoKCQlpZiAoJCgnOmlucHV0W25hbWU9c3VibWl0XSw6aW5wdXRbaWQ9c3VibWl0XScsIGZvcm0pLmxlbmd0aCkgewoJCQkvLyBpZiB0aGVyZSBpcyBhbiBpbnB1dCB3aXRoIGEgbmFtZSBvciBpZCBvZiAnc3VibWl0JyB0aGVuIHdlIHdvbid0IGJlCgkJCS8vIGFibGUgdG8gaW52b2tlIHRoZSBzdWJtaXQgZm4gb24gdGhlIGZvcm0gKGF0IGxlYXN0IG5vdCB4LWJyb3dzZXIpCgkJCWFsZXJ0KCdFcnJvcjogRm9ybSBlbGVtZW50cyBtdXN0IG5vdCBoYXZlIG5hbWUgb3IgaWQgb2YgInN1Ym1pdCIuJyk7CgkJCXJldHVybjsKCQl9CgkJCgkJcyA9ICQuZXh0ZW5kKHRydWUsIHt9LCAkLmFqYXhTZXR0aW5ncywgb3B0aW9ucyk7CgkJcy5jb250ZXh0ID0gcy5jb250ZXh0IHx8IHM7CgkJaWQgPSAnanFGb3JtSU8nICsgKG5ldyBEYXRlKCkuZ2V0VGltZSgpKTsKCQlpZiAocy5pZnJhbWVUYXJnZXQpIHsKCQkJJGlvID0gJChzLmlmcmFtZVRhcmdldCk7CgkJCW4gPSAkaW8uYXR0cignbmFtZScpOwoJCQlpZiAobiA9PSBudWxsKQoJCQkgCSRpby5hdHRyKCduYW1lJywgaWQpOwoJCQllbHNlCgkJCQlpZCA9IG47CgkJfQoJCWVsc2UgewoJCQkkaW8gPSAkKCc8aWZyYW1lIG5hbWU9IicgKyBpZCArICciIHNyYz0iJysgcy5pZnJhbWVTcmMgKyciIC8+Jyk7CgkJCSRpby5jc3MoeyBwb3NpdGlvbjogJ2Fic29sdXRlJywgdG9wOiAnLTEwMDBweCcsIGxlZnQ6ICctMTAwMHB4JyB9KTsKCQl9CgkJaW8gPSAkaW9bMF07CgoKCQl4aHIgPSB7IC8vIG1vY2sgb2JqZWN0CgkJCWFib3J0ZWQ6IDAsCgkJCXJlc3BvbnNlVGV4dDogbnVsbCwKCQkJcmVzcG9uc2VYTUw6IG51bGwsCgkJCXN0YXR1czogMCwKCQkJc3RhdHVzVGV4dDogJ24vYScsCgkJCWdldEFsbFJlc3BvbnNlSGVhZGVyczogZnVuY3Rpb24oKSB7fSwKCQkJZ2V0UmVzcG9uc2VIZWFkZXI6IGZ1bmN0aW9uKCkge30sCgkJCXNldFJlcXVlc3RIZWFkZXI6IGZ1bmN0aW9uKCkge30sCgkJCWFib3J0OiBmdW5jdGlvbihzdGF0dXMpIHsKCQkJCXZhciBlID0gKHN0YXR1cyA9PT0gJ3RpbWVvdXQnID8gJ3RpbWVvdXQnIDogJ2Fib3J0ZWQnKTsKCQkJCWxvZygnYWJvcnRpbmcgdXBsb2FkLi4uICcgKyBlKTsKCQkJCXRoaXMuYWJvcnRlZCA9IDE7CgkJCQkkaW8uYXR0cignc3JjJywgcy5pZnJhbWVTcmMpOyAvLyBhYm9ydCBvcCBpbiBwcm9ncmVzcwoJCQkJeGhyLmVycm9yID0gZTsKCQkJCXMuZXJyb3IgJiYgcy5lcnJvci5jYWxsKHMuY29udGV4dCwgeGhyLCBlLCBzdGF0dXMpOwoJCQkJZyAmJiAkLmV2ZW50LnRyaWdnZXIoImFqYXhFcnJvciIsIFt4aHIsIHMsIGVdKTsKCQkJCXMuY29tcGxldGUgJiYgcy5jb21wbGV0ZS5jYWxsKHMuY29udGV4dCwgeGhyLCBlKTsKCQkJfQoJCX07CgoJCWcgPSBzLmdsb2JhbDsKCQkvLyB0cmlnZ2VyIGFqYXggZ2xvYmFsIGV2ZW50cyBzbyB0aGF0IGFjdGl2aXR5L2Jsb2NrIGluZGljYXRvcnMgd29yayBsaWtlIG5vcm1hbAoJCWlmIChnICYmICEgJC5hY3RpdmUrKykgewoJCQkkLmV2ZW50LnRyaWdnZXIoImFqYXhTdGFydCIpOwoJCX0KCQlpZiAoZykgewoJCQkkLmV2ZW50LnRyaWdnZXIoImFqYXhTZW5kIiwgW3hociwgc10pOwoJCX0KCgkJaWYgKHMuYmVmb3JlU2VuZCAmJiBzLmJlZm9yZVNlbmQuY2FsbChzLmNvbnRleHQsIHhociwgcykgPT09IGZhbHNlKSB7CgkJCWlmIChzLmdsb2JhbCkgewoJCQkJJC5hY3RpdmUtLTsKCQkJfQoJCQlyZXR1cm47CgkJfQoJCWlmICh4aHIuYWJvcnRlZCkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBhZGQgc3VibWl0dGluZyBlbGVtZW50IHRvIGRhdGEgaWYgd2Uga25vdyBpdAoJCXN1YiA9IGZvcm0uY2xrOwoJCWlmIChzdWIpIHsKCQkJbiA9IHN1Yi5uYW1lOwoJCQlpZiAobiAmJiAhc3ViLmRpc2FibGVkKSB7CgkJCQlzLmV4dHJhRGF0YSA9IHMuZXh0cmFEYXRhIHx8IHt9OwoJCQkJcy5leHRyYURhdGFbbl0gPSBzdWIudmFsdWU7CgkJCQlpZiAoc3ViLnR5cGUgPT0gImltYWdlIikgewoJCQkJCXMuZXh0cmFEYXRhW24rJy54J10gPSBmb3JtLmNsa194OwoJCQkJCXMuZXh0cmFEYXRhW24rJy55J10gPSBmb3JtLmNsa195OwoJCQkJfQoJCQl9CgkJfQoJCQoJCXZhciBDTElFTlRfVElNRU9VVF9BQk9SVCA9IDE7CgkJdmFyIFNFUlZFUl9BQk9SVCA9IDI7CgoJCWZ1bmN0aW9uIGdldERvYyhmcmFtZSkgewoJCQl2YXIgZG9jID0gZnJhbWUuY29udGVudFdpbmRvdyA/IGZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQgOiBmcmFtZS5jb250ZW50RG9jdW1lbnQgPyBmcmFtZS5jb250ZW50RG9jdW1lbnQgOiBmcmFtZS5kb2N1bWVudDsKCQkJcmV0dXJuIGRvYzsKCQl9CgkJCgkJLy8gdGFrZSBhIGJyZWF0aCBzbyB0aGF0IHBlbmRpbmcgcmVwYWludHMgZ2V0IHNvbWUgY3B1IHRpbWUgYmVmb3JlIHRoZSB1cGxvYWQgc3RhcnRzCgkJZnVuY3Rpb24gZG9TdWJtaXQoKSB7CgkJCS8vIG1ha2Ugc3VyZSBmb3JtIGF0dHJzIGFyZSBzZXQKCQkJdmFyIHQgPSAkZm9ybS5hdHRyKCd0YXJnZXQnKSwgYSA9ICRmb3JtLmF0dHIoJ2FjdGlvbicpOwoKCQkJLy8gdXBkYXRlIGZvcm0gYXR0cnMgaW4gSUUgZnJpZW5kbHkgd2F5CgkJCWZvcm0uc2V0QXR0cmlidXRlKCd0YXJnZXQnLGlkKTsKCQkJaWYgKCFtZXRob2QpIHsKCQkJCWZvcm0uc2V0QXR0cmlidXRlKCdtZXRob2QnLCAnUE9TVCcpOwoJCQl9CgkJCWlmIChhICE9IHMudXJsKSB7CgkJCQlmb3JtLnNldEF0dHJpYnV0ZSgnYWN0aW9uJywgcy51cmwpOwoJCQl9CgoJCQkvLyBpZSBib3JrcyBpbiBzb21lIGNhc2VzIHdoZW4gc2V0dGluZyBlbmNvZGluZwoJCQlpZiAoISBzLnNraXBFbmNvZGluZ092ZXJyaWRlICYmICghbWV0aG9kIHx8IC9wb3N0L2kudGVzdChtZXRob2QpKSkgewoJCQkJJGZvcm0uYXR0cih7CgkJCQkJZW5jb2Rpbmc6ICdtdWx0aXBhcnQvZm9ybS1kYXRhJywKCQkJCQllbmN0eXBlOiAgJ211bHRpcGFydC9mb3JtLWRhdGEnCgkJCQl9KTsKCQkJfQoKCQkJLy8gc3VwcG9ydCB0aW1vdXQKCQkJaWYgKHMudGltZW91dCkgewoJCQkJdGltZW91dEhhbmRsZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IHRpbWVkT3V0ID0gdHJ1ZTsgY2IoQ0xJRU5UX1RJTUVPVVRfQUJPUlQpOyB9LCBzLnRpbWVvdXQpOwoJCQl9CgkJCQoJCQkvLyBsb29rIGZvciBzZXJ2ZXIgYWJvcnRzCgkJCWZ1bmN0aW9uIGNoZWNrU3RhdGUoKSB7CgkJCQl0cnkgewoJCQkJCXZhciBzdGF0ZSA9IGdldERvYyhpbykucmVhZHlTdGF0ZTsKCQkJCQlsb2coJ3N0YXRlID0gJyArIHN0YXRlKTsKCQkJCQlpZiAoc3RhdGUudG9Mb3dlckNhc2UoKSA9PSAndW5pbml0aWFsaXplZCcpCgkJCQkJCXNldFRpbWVvdXQoY2hlY2tTdGF0ZSw1MCk7CgkJCQl9CgkJCQljYXRjaChlKSB7CgkJCQkJbG9nKCdTZXJ2ZXIgYWJvcnQ6ICcgLCBlLCAnICgnLCBlLm5hbWUsICcpJyk7CgkJCQkJY2IoU0VSVkVSX0FCT1JUKTsKCQkJCQl0aW1lb3V0SGFuZGxlICYmIGNsZWFyVGltZW91dCh0aW1lb3V0SGFuZGxlKTsKCQkJCQl0aW1lb3V0SGFuZGxlID0gdW5kZWZpbmVkOwoJCQkJfQoJCQl9CgoJCQkvLyBhZGQgImV4dHJhIiBkYXRhIHRvIGZvcm0gaWYgcHJvdmlkZWQgaW4gb3B0aW9ucwoJCQl2YXIgZXh0cmFJbnB1dHMgPSBbXTsKCQkJdHJ5IHsKCQkJCWlmIChzLmV4dHJhRGF0YSkgewoJCQkJCWZvciAodmFyIG4gaW4gcy5leHRyYURhdGEpIHsKCQkJCQkJZXh0cmFJbnB1dHMucHVzaCgKCQkJCQkJCSQoJzxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9IicrbisnIiAvPicpLmF0dHIoJ3ZhbHVlJyxzLmV4dHJhRGF0YVtuXSkKCQkJCQkJCQkuYXBwZW5kVG8oZm9ybSlbMF0pOwoJCQkJCX0KCQkJCX0KCgkJCQlpZiAoIXMuaWZyYW1lVGFyZ2V0KSB7CgkJCQkJLy8gYWRkIGlmcmFtZSB0byBkb2MgYW5kIHN1Ym1pdCB0aGUgZm9ybQoJCQkJCSRpby5hcHBlbmRUbygnYm9keScpOwoJICAgICAgICAgICAgICAgIGlvLmF0dGFjaEV2ZW50ID8gaW8uYXR0YWNoRXZlbnQoJ29ubG9hZCcsIGNiKSA6IGlvLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBjYiwgZmFsc2UpOwoJCQkJfQoJCQkJc2V0VGltZW91dChjaGVja1N0YXRlLDE1KTsKCQkJCWZvcm0uc3VibWl0KCk7CgkJCX0KCQkJZmluYWxseSB7CgkJCQkvLyByZXNldCBhdHRycyBhbmQgcmVtb3ZlICJleHRyYSIgaW5wdXQgZWxlbWVudHMKCQkJCWZvcm0uc2V0QXR0cmlidXRlKCdhY3Rpb24nLGEpOwoJCQkJaWYodCkgewoJCQkJCWZvcm0uc2V0QXR0cmlidXRlKCd0YXJnZXQnLCB0KTsKCQkJCX0gZWxzZSB7CgkJCQkJJGZvcm0ucmVtb3ZlQXR0cigndGFyZ2V0Jyk7CgkJCQl9CgkJCQkkKGV4dHJhSW5wdXRzKS5yZW1vdmUoKTsKCQkJfQoJCX0KCgkJaWYgKHMuZm9yY2VTeW5jKSB7CgkJCWRvU3VibWl0KCk7CgkJfQoJCWVsc2UgewoJCQlzZXRUaW1lb3V0KGRvU3VibWl0LCAxMCk7IC8vIHRoaXMgbGV0cyBkb20gdXBkYXRlcyByZW5kZXIKCQl9CgoJCXZhciBkYXRhLCBkb2MsIGRvbUNoZWNrQ291bnQgPSA1MCwgY2FsbGJhY2tQcm9jZXNzZWQ7CgoJCWZ1bmN0aW9uIGNiKGUpIHsKCQkJaWYgKHhoci5hYm9ydGVkIHx8IGNhbGxiYWNrUHJvY2Vzc2VkKSB7CgkJCQlyZXR1cm47CgkJCX0KCQkJdHJ5IHsKCQkJCWRvYyA9IGdldERvYyhpbyk7CgkJCX0KCQkJY2F0Y2goZXgpIHsKCQkJCWxvZygnY2Fubm90IGFjY2VzcyByZXNwb25zZSBkb2N1bWVudDogJywgZXgpOwoJCQkJZSA9IFNFUlZFUl9BQk9SVDsKCQkJfQoJCQlpZiAoZSA9PT0gQ0xJRU5UX1RJTUVPVVRfQUJPUlQgJiYgeGhyKSB7CgkJCQl4aHIuYWJvcnQoJ3RpbWVvdXQnKTsKCQkJCXJldHVybjsKCQkJfQoJCQllbHNlIGlmIChlID09IFNFUlZFUl9BQk9SVCAmJiB4aHIpIHsKCQkJCXhoci5hYm9ydCgnc2VydmVyIGFib3J0Jyk7CgkJCQlyZXR1cm47CgkJCX0KCgkJCWlmICghZG9jIHx8IGRvYy5sb2NhdGlvbi5ocmVmID09IHMuaWZyYW1lU3JjKSB7CgkJCQkvLyByZXNwb25zZSBub3QgcmVjZWl2ZWQgeWV0CgkJCQlpZiAoIXRpbWVkT3V0KQoJCQkJCXJldHVybjsKCQkJfQogICAgICAgICAgICBpby5kZXRhY2hFdmVudCA/IGlvLmRldGFjaEV2ZW50KCdvbmxvYWQnLCBjYikgOiBpby5yZW1vdmVFdmVudExpc3RlbmVyKCdsb2FkJywgY2IsIGZhbHNlKTsKCgkJCXZhciBzdGF0dXMgPSAnc3VjY2VzcycsIGVyck1zZzsKCQkJdHJ5IHsKCQkJCWlmICh0aW1lZE91dCkgewoJCQkJCXRocm93ICd0aW1lb3V0JzsKCQkJCX0KCgkJCQl2YXIgaXNYbWwgPSBzLmRhdGFUeXBlID09ICd4bWwnIHx8IGRvYy5YTUxEb2N1bWVudCB8fCAkLmlzWE1MRG9jKGRvYyk7CgkJCQlsb2coJ2lzWG1sPScraXNYbWwpOwoJCQkJaWYgKCFpc1htbCAmJiB3aW5kb3cub3BlcmEgJiYgKGRvYy5ib2R5ID09IG51bGwgfHwgZG9jLmJvZHkuaW5uZXJIVE1MID09ICcnKSkgewoJCQkJCWlmICgtLWRvbUNoZWNrQ291bnQpIHsKCQkJCQkJLy8gaW4gc29tZSBicm93c2VycyAoT3BlcmEpIHRoZSBpZnJhbWUgRE9NIGlzIG5vdCBhbHdheXMgdHJhdmVyc2FibGUgd2hlbgoJCQkJCQkvLyB0aGUgb25sb2FkIGNhbGxiYWNrIGZpcmVzLCBzbyB3ZSBsb29wIGEgYml0IHRvIGFjY29tbW9kYXRlCgkJCQkJCWxvZygncmVxdWVpbmcgb25Mb2FkIGNhbGxiYWNrLCBET00gbm90IGF2YWlsYWJsZScpOwoJCQkJCQlzZXRUaW1lb3V0KGNiLCAyNTApOwoJCQkJCQlyZXR1cm47CgkJCQkJfQoJCQkJCS8vIGxldCB0aGlzIGZhbGwgdGhyb3VnaCBiZWNhdXNlIHNlcnZlciByZXNwb25zZSBjb3VsZCBiZSBhbiBlbXB0eSBkb2N1bWVudAoJCQkJCS8vbG9nKCdDb3VsZCBub3QgYWNjZXNzIGlmcmFtZSBET00gYWZ0ZXIgbXV0aXBsZSB0cmllcy4nKTsKCQkJCQkvL3Rocm93ICdET01FeGNlcHRpb246IG5vdCBhdmFpbGFibGUnOwoJCQkJfQoKCQkJCS8vbG9nKCdyZXNwb25zZSBkZXRlY3RlZCcpOwogICAgICAgICAgICAgICAgdmFyIGRvY1Jvb3QgPSBkb2MuYm9keSA/IGRvYy5ib2R5IDogZG9jLmRvY3VtZW50RWxlbWVudDsKICAgICAgICAgICAgICAgIHhoci5yZXNwb25zZVRleHQgPSBkb2NSb290ID8gZG9jUm9vdC5pbm5lckhUTUwgOiBudWxsOwoJCQkJeGhyLnJlc3BvbnNlWE1MID0gZG9jLlhNTERvY3VtZW50ID8gZG9jLlhNTERvY3VtZW50IDogZG9jOwoJCQkJaWYgKGlzWG1sKQoJCQkJCXMuZGF0YVR5cGUgPSAneG1sJzsKCQkJCXhoci5nZXRSZXNwb25zZUhlYWRlciA9IGZ1bmN0aW9uKGhlYWRlcil7CgkJCQkJdmFyIGhlYWRlcnMgPSB7J2NvbnRlbnQtdHlwZSc6IHMuZGF0YVR5cGV9OwoJCQkJCXJldHVybiBoZWFkZXJzW2hlYWRlcl07CgkJCQl9OwogICAgICAgICAgICAgICAgLy8gc3VwcG9ydCBmb3IgWEhSICdzdGF0dXMnICYgJ3N0YXR1c1RleHQnIGVtdWxhdGlvbiA6CiAgICAgICAgICAgICAgICBpZiAoZG9jUm9vdCkgewogICAgICAgICAgICAgICAgICAgIHhoci5zdGF0dXMgPSBOdW1iZXIoIGRvY1Jvb3QuZ2V0QXR0cmlidXRlKCdzdGF0dXMnKSApIHx8IHhoci5zdGF0dXM7CiAgICAgICAgICAgICAgICAgICAgeGhyLnN0YXR1c1RleHQgPSBkb2NSb290LmdldEF0dHJpYnV0ZSgnc3RhdHVzVGV4dCcpIHx8IHhoci5zdGF0dXNUZXh0OwogICAgICAgICAgICAgICAgfQoKCQkJCXZhciBkdCA9IHMuZGF0YVR5cGUgfHwgJyc7CgkJCQl2YXIgc2NyID0gLyhqc29ufHNjcmlwdHx0ZXh0KS8udGVzdChkdC50b0xvd2VyQ2FzZSgpKTsKCQkJCWlmIChzY3IgfHwgcy50ZXh0YXJlYSkgewoJCQkJCS8vIHNlZSBpZiB1c2VyIGVtYmVkZGVkIHJlc3BvbnNlIGluIHRleHRhcmVhCgkJCQkJdmFyIHRhID0gZG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0ZXh0YXJlYScpWzBdOwoJCQkJCWlmICh0YSkgewoJCQkJCQl4aHIucmVzcG9uc2VUZXh0ID0gdGEudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN1cHBvcnQgZm9yIFhIUiAnc3RhdHVzJyAmICdzdGF0dXNUZXh0JyBlbXVsYXRpb24gOgogICAgICAgICAgICAgICAgICAgICAgICB4aHIuc3RhdHVzID0gTnVtYmVyKCB0YS5nZXRBdHRyaWJ1dGUoJ3N0YXR1cycpICkgfHwgeGhyLnN0YXR1czsKICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnN0YXR1c1RleHQgPSB0YS5nZXRBdHRyaWJ1dGUoJ3N0YXR1c1RleHQnKSB8fCB4aHIuc3RhdHVzVGV4dDsKCQkJCQl9CgkJCQkJZWxzZSBpZiAoc2NyKSB7CgkJCQkJCS8vIGFjY291bnQgZm9yIGJyb3dzZXJzIGluamVjdGluZyBwcmUgYXJvdW5kIGpzb24gcmVzcG9uc2UKCQkJCQkJdmFyIHByZSA9IGRvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgncHJlJylbMF07CgkJCQkJCXZhciBiID0gZG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdib2R5JylbMF07CgkJCQkJCWlmIChwcmUpIHsKCQkJCQkJCXhoci5yZXNwb25zZVRleHQgPSBwcmUudGV4dENvbnRlbnQgPyBwcmUudGV4dENvbnRlbnQgOiBwcmUuaW5uZXJIVE1MOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKGIpIHsKCQkJCQkJCXhoci5yZXNwb25zZVRleHQgPSBiLmlubmVySFRNTDsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCWVsc2UgaWYgKHMuZGF0YVR5cGUgPT0gJ3htbCcgJiYgIXhoci5yZXNwb25zZVhNTCAmJiB4aHIucmVzcG9uc2VUZXh0ICE9IG51bGwpIHsKCQkJCQl4aHIucmVzcG9uc2VYTUwgPSB0b1htbCh4aHIucmVzcG9uc2VUZXh0KTsKCQkJCX0KCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBodHRwRGF0YSh4aHIsIHMuZGF0YVR5cGUsIHMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSAncGFyc2VyZXJyb3InOwogICAgICAgICAgICAgICAgICAgIHhoci5lcnJvciA9IGVyck1zZyA9IChlIHx8IHN0YXR1cyk7CiAgICAgICAgICAgICAgICB9CgkJCX0KCQkJY2F0Y2ggKGUpIHsKCQkJCWxvZygnZXJyb3IgY2F1Z2h0OiAnLGUpOwoJCQkJc3RhdHVzID0gJ2Vycm9yJzsKICAgICAgICAgICAgICAgIHhoci5lcnJvciA9IGVyck1zZyA9IChlIHx8IHN0YXR1cyk7CgkJCX0KCgkJCWlmICh4aHIuYWJvcnRlZCkgewoJCQkJbG9nKCd1cGxvYWQgYWJvcnRlZCcpOwoJCQkJc3RhdHVzID0gbnVsbDsKCQkJfQoKICAgICAgICAgICAgaWYgKHhoci5zdGF0dXMpIHsgLy8gd2UndmUgc2V0IHhoci5zdGF0dXMKICAgICAgICAgICAgICAgIHN0YXR1cyA9ICh4aHIuc3RhdHVzID49IDIwMCAmJiB4aHIuc3RhdHVzIDwgMzAwIHx8IHhoci5zdGF0dXMgPT09IDMwNCkgPyAnc3VjY2VzcycgOiAnZXJyb3InOwogICAgICAgICAgICB9CgoJCQkvLyBvcmRlcmluZyBvZiB0aGVzZSBjYWxsYmFja3MvdHJpZ2dlcnMgaXMgb2RkLCBidXQgdGhhdCdzIGhvdyAkLmFqYXggZG9lcyBpdAoJCQlpZiAoc3RhdHVzID09PSAnc3VjY2VzcycpIHsKCQkJCXMuc3VjY2VzcyAmJiBzLnN1Y2Nlc3MuY2FsbChzLmNvbnRleHQsIGRhdGEsICdzdWNjZXNzJywgeGhyKTsKCQkJCWcgJiYgJC5ldmVudC50cmlnZ2VyKCJhamF4U3VjY2VzcyIsIFt4aHIsIHNdKTsKCQkJfQogICAgICAgICAgICBlbHNlIGlmIChzdGF0dXMpIHsKCQkJCWlmIChlcnJNc2cgPT0gdW5kZWZpbmVkKQoJCQkJCWVyck1zZyA9IHhoci5zdGF0dXNUZXh0OwoJCQkJcy5lcnJvciAmJiBzLmVycm9yLmNhbGwocy5jb250ZXh0LCB4aHIsIHN0YXR1cywgZXJyTXNnKTsKCQkJCWcgJiYgJC5ldmVudC50cmlnZ2VyKCJhamF4RXJyb3IiLCBbeGhyLCBzLCBlcnJNc2ddKTsKICAgICAgICAgICAgfQoKCQkJZyAmJiAkLmV2ZW50LnRyaWdnZXIoImFqYXhDb21wbGV0ZSIsIFt4aHIsIHNdKTsKCgkJCWlmIChnICYmICEgLS0kLmFjdGl2ZSkgewoJCQkJJC5ldmVudC50cmlnZ2VyKCJhamF4U3RvcCIpOwoJCQl9CgoJCQlzLmNvbXBsZXRlICYmIHMuY29tcGxldGUuY2FsbChzLmNvbnRleHQsIHhociwgc3RhdHVzKTsKCgkJCWNhbGxiYWNrUHJvY2Vzc2VkID0gdHJ1ZTsKCQkJaWYgKHMudGltZW91dCkKCQkJCWNsZWFyVGltZW91dCh0aW1lb3V0SGFuZGxlKTsKCgkJCS8vIGNsZWFuIHVwCgkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCQlpZiAoIXMuaWZyYW1lVGFyZ2V0KQoJCQkJCSRpby5yZW1vdmUoKTsKCQkJCXhoci5yZXNwb25zZVhNTCA9IG51bGw7CgkJCX0sIDEwMCk7CgkJfQoKCQl2YXIgdG9YbWwgPSAkLnBhcnNlWE1MIHx8IGZ1bmN0aW9uKHMsIGRvYykgeyAvLyB1c2UgcGFyc2VYTUwgaWYgYXZhaWxhYmxlIChqUXVlcnkgMS41KykKCQkJaWYgKHdpbmRvdy5BY3RpdmVYT2JqZWN0KSB7CgkJCQlkb2MgPSBuZXcgQWN0aXZlWE9iamVjdCgnTWljcm9zb2Z0LlhNTERPTScpOwoJCQkJZG9jLmFzeW5jID0gJ2ZhbHNlJzsKCQkJCWRvYy5sb2FkWE1MKHMpOwoJCQl9CgkJCWVsc2UgewoJCQkJZG9jID0gKG5ldyBET01QYXJzZXIoKSkucGFyc2VGcm9tU3RyaW5nKHMsICd0ZXh0L3htbCcpOwoJCQl9CgkJCXJldHVybiAoZG9jICYmIGRvYy5kb2N1bWVudEVsZW1lbnQgJiYgZG9jLmRvY3VtZW50RWxlbWVudC5ub2RlTmFtZSAhPSAncGFyc2VyZXJyb3InKSA/IGRvYyA6IG51bGw7CgkJfTsKCQl2YXIgcGFyc2VKU09OID0gJC5wYXJzZUpTT04gfHwgZnVuY3Rpb24ocykgewoJCQlyZXR1cm4gd2luZG93WydldmFsJ10oJygnICsgcyArICcpJyk7CgkJfTsKCgkJdmFyIGh0dHBEYXRhID0gZnVuY3Rpb24oIHhociwgdHlwZSwgcyApIHsgLy8gbW9zdGx5IGxpZnRlZCBmcm9tIGpxMS40LjQKCgkJCXZhciBjdCA9IHhoci5nZXRSZXNwb25zZUhlYWRlcignY29udGVudC10eXBlJykgfHwgJycsCgkJCQl4bWwgPSB0eXBlID09PSAneG1sJyB8fCAhdHlwZSAmJiBjdC5pbmRleE9mKCd4bWwnKSA+PSAwLAoJCQkJZGF0YSA9IHhtbCA/IHhoci5yZXNwb25zZVhNTCA6IHhoci5yZXNwb25zZVRleHQ7CgoJCQlpZiAoeG1sICYmIGRhdGEuZG9jdW1lbnRFbGVtZW50Lm5vZGVOYW1lID09PSAncGFyc2VyZXJyb3InKSB7CgkJCQkkLmVycm9yICYmICQuZXJyb3IoJ3BhcnNlcmVycm9yJyk7CgkJCX0KCQkJaWYgKHMgJiYgcy5kYXRhRmlsdGVyKSB7CgkJCQlkYXRhID0gcy5kYXRhRmlsdGVyKGRhdGEsIHR5cGUpOwoJCQl9CgkJCWlmICh0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycpIHsKCQkJCWlmICh0eXBlID09PSAnanNvbicgfHwgIXR5cGUgJiYgY3QuaW5kZXhPZignanNvbicpID49IDApIHsKCQkJCQlkYXRhID0gcGFyc2VKU09OKGRhdGEpOwoJCQkJfSBlbHNlIGlmICh0eXBlID09PSAic2NyaXB0IiB8fCAhdHlwZSAmJiBjdC5pbmRleE9mKCJqYXZhc2NyaXB0IikgPj0gMCkgewoJCQkJCSQuZ2xvYmFsRXZhbChkYXRhKTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gZGF0YTsKCQl9OwoJfQp9OwoKLyoqCiAqIGFqYXhGb3JtKCkgcHJvdmlkZXMgYSBtZWNoYW5pc20gZm9yIGZ1bGx5IGF1dG9tYXRpbmcgZm9ybSBzdWJtaXNzaW9uLgogKgogKiBUaGUgYWR2YW50YWdlcyBvZiB1c2luZyB0aGlzIG1ldGhvZCBpbnN0ZWFkIG9mIGFqYXhTdWJtaXQoKSBhcmU6CiAqCiAqIDE6IFRoaXMgbWV0aG9kIHdpbGwgaW5jbHVkZSBjb29yZGluYXRlcyBmb3IgPGlucHV0IHR5cGU9ImltYWdlIiAvPiBlbGVtZW50cyAoaWYgdGhlIGVsZW1lbnQKICoJaXMgdXNlZCB0byBzdWJtaXQgdGhlIGZvcm0pLgogKiAyLiBUaGlzIG1ldGhvZCB3aWxsIGluY2x1ZGUgdGhlIHN1Ym1pdCBlbGVtZW50J3MgbmFtZS92YWx1ZSBkYXRhIChmb3IgdGhlIGVsZW1lbnQgdGhhdCB3YXMKICoJdXNlZCB0byBzdWJtaXQgdGhlIGZvcm0pLgogKiAzLiBUaGlzIG1ldGhvZCBiaW5kcyB0aGUgc3VibWl0KCkgbWV0aG9kIHRvIHRoZSBmb3JtIGZvciB5b3UuCiAqCiAqIFRoZSBvcHRpb25zIGFyZ3VtZW50IGZvciBhamF4Rm9ybSB3b3JrcyBleGFjdGx5IGFzIGl0IGRvZXMgZm9yIGFqYXhTdWJtaXQuICBhamF4Rm9ybSBtZXJlbHkKICogcGFzc2VzIHRoZSBvcHRpb25zIGFyZ3VtZW50IGFsb25nIGFmdGVyIHByb3Blcmx5IGJpbmRpbmcgZXZlbnRzIGZvciBzdWJtaXQgZWxlbWVudHMgYW5kCiAqIHRoZSBmb3JtIGl0c2VsZi4KICovCiQuZm4uYWpheEZvcm0gPSBmdW5jdGlvbihvcHRpb25zKSB7CgkvLyBpbiBqUXVlcnkgMS4zKyB3ZSBjYW4gZml4IG1pc3Rha2VzIHdpdGggdGhlIHJlYWR5IHN0YXRlCglpZiAodGhpcy5sZW5ndGggPT09IDApIHsKCQl2YXIgbyA9IHsgczogdGhpcy5zZWxlY3RvciwgYzogdGhpcy5jb250ZXh0IH07CgkJaWYgKCEkLmlzUmVhZHkgJiYgby5zKSB7CgkJCWxvZygnRE9NIG5vdCByZWFkeSwgcXVldWluZyBhamF4Rm9ybScpOwoJCQkkKGZ1bmN0aW9uKCkgewoJCQkJJChvLnMsby5jKS5hamF4Rm9ybShvcHRpb25zKTsKCQkJfSk7CgkJCXJldHVybiB0aGlzOwoJCX0KCQkvLyBpcyB5b3VyIERPTSByZWFkeT8gIGh0dHA6Ly9kb2NzLmpxdWVyeS5jb20vVHV0b3JpYWxzOkludHJvZHVjaW5nXyQoZG9jdW1lbnQpLnJlYWR5KCkKCQlsb2coJ3Rlcm1pbmF0aW5nOyB6ZXJvIGVsZW1lbnRzIGZvdW5kIGJ5IHNlbGVjdG9yJyArICgkLmlzUmVhZHkgPyAnJyA6ICcgKERPTSBub3QgcmVhZHkpJykpOwoJCXJldHVybiB0aGlzOwoJfQoKCXJldHVybiB0aGlzLmFqYXhGb3JtVW5iaW5kKCkuYmluZCgnc3VibWl0LmZvcm0tcGx1Z2luJywgZnVuY3Rpb24oZSkgewoJCWlmICghZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgeyAvLyBpZiBldmVudCBoYXMgYmVlbiBjYW5jZWxlZCwgZG9uJ3QgcHJvY2VlZAoJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCSQodGhpcykuYWpheFN1Ym1pdChvcHRpb25zKTsKCQl9Cgl9KS5iaW5kKCdjbGljay5mb3JtLXBsdWdpbicsIGZ1bmN0aW9uKGUpIHsKCQl2YXIgdGFyZ2V0ID0gZS50YXJnZXQ7CgkJdmFyICRlbCA9ICQodGFyZ2V0KTsKCQlpZiAoISgkZWwuaXMoIjpzdWJtaXQsaW5wdXQ6aW1hZ2UiKSkpIHsKCQkJLy8gaXMgdGhpcyBhIGNoaWxkIGVsZW1lbnQgb2YgdGhlIHN1Ym1pdCBlbD8gIChleDogYSBzcGFuIHdpdGhpbiBhIGJ1dHRvbikKCQkJdmFyIHQgPSAkZWwuY2xvc2VzdCgnOnN1Ym1pdCcpOwoJCQlpZiAodC5sZW5ndGggPT0gMCkgewoJCQkJcmV0dXJuOwoJCQl9CgkJCXRhcmdldCA9IHRbMF07CgkJfQoJCXZhciBmb3JtID0gdGhpczsKCQlmb3JtLmNsayA9IHRhcmdldDsKCQlpZiAodGFyZ2V0LnR5cGUgPT0gJ2ltYWdlJykgewoJCQlpZiAoZS5vZmZzZXRYICE9IHVuZGVmaW5lZCkgewoJCQkJZm9ybS5jbGtfeCA9IGUub2Zmc2V0WDsKCQkJCWZvcm0uY2xrX3kgPSBlLm9mZnNldFk7CgkJCX0gZWxzZSBpZiAodHlwZW9mICQuZm4ub2Zmc2V0ID09ICdmdW5jdGlvbicpIHsgLy8gdHJ5IHRvIHVzZSBkaW1lbnNpb25zIHBsdWdpbgoJCQkJdmFyIG9mZnNldCA9ICRlbC5vZmZzZXQoKTsKCQkJCWZvcm0uY2xrX3ggPSBlLnBhZ2VYIC0gb2Zmc2V0LmxlZnQ7CgkJCQlmb3JtLmNsa195ID0gZS5wYWdlWSAtIG9mZnNldC50b3A7CgkJCX0gZWxzZSB7CgkJCQlmb3JtLmNsa194ID0gZS5wYWdlWCAtIHRhcmdldC5vZmZzZXRMZWZ0OwoJCQkJZm9ybS5jbGtfeSA9IGUucGFnZVkgLSB0YXJnZXQub2Zmc2V0VG9wOwoJCQl9CgkJfQoJCS8vIGNsZWFyIGZvcm0gdmFycwoJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IGZvcm0uY2xrID0gZm9ybS5jbGtfeCA9IGZvcm0uY2xrX3kgPSBudWxsOyB9LCAxMDApOwoJfSk7Cn07CgovLyBhamF4Rm9ybVVuYmluZCB1bmJpbmRzIHRoZSBldmVudCBoYW5kbGVycyB0aGF0IHdlcmUgYm91bmQgYnkgYWpheEZvcm0KJC5mbi5hamF4Rm9ybVVuYmluZCA9IGZ1bmN0aW9uKCkgewoJcmV0dXJuIHRoaXMudW5iaW5kKCdzdWJtaXQuZm9ybS1wbHVnaW4gY2xpY2suZm9ybS1wbHVnaW4nKTsKfTsKCi8qKgogKiBmb3JtVG9BcnJheSgpIGdhdGhlcnMgZm9ybSBlbGVtZW50IGRhdGEgaW50byBhbiBhcnJheSBvZiBvYmplY3RzIHRoYXQgY2FuCiAqIGJlIHBhc3NlZCB0byBhbnkgb2YgdGhlIGZvbGxvd2luZyBhamF4IGZ1bmN0aW9uczogJC5nZXQsICQucG9zdCwgb3IgbG9hZC4KICogRWFjaCBvYmplY3QgaW4gdGhlIGFycmF5IGhhcyBib3RoIGEgJ25hbWUnIGFuZCAndmFsdWUnIHByb3BlcnR5LiAgQW4gZXhhbXBsZSBvZgogKiBhbiBhcnJheSBmb3IgYSBzaW1wbGUgbG9naW4gZm9ybSBtaWdodCBiZToKICoKICogWyB7IG5hbWU6ICd1c2VybmFtZScsIHZhbHVlOiAnanJlc2lnJyB9LCB7IG5hbWU6ICdwYXNzd29yZCcsIHZhbHVlOiAnc2VjcmV0JyB9IF0KICoKICogSXQgaXMgdGhpcyBhcnJheSB0aGF0IGlzIHBhc3NlZCB0byBwcmUtc3VibWl0IGNhbGxiYWNrIGZ1bmN0aW9ucyBwcm92aWRlZCB0byB0aGUKICogYWpheFN1Ym1pdCgpIGFuZCBhamF4Rm9ybSgpIG1ldGhvZHMuCiAqLwokLmZuLmZvcm1Ub0FycmF5ID0gZnVuY3Rpb24oc2VtYW50aWMpIHsKCXZhciBhID0gW107CglpZiAodGhpcy5sZW5ndGggPT09IDApIHsKCQlyZXR1cm4gYTsKCX0KCgl2YXIgZm9ybSA9IHRoaXNbMF07Cgl2YXIgZWxzID0gc2VtYW50aWMgPyBmb3JtLmdldEVsZW1lbnRzQnlUYWdOYW1lKCcqJykgOiBmb3JtLmVsZW1lbnRzOwoJaWYgKCFlbHMpIHsKCQlyZXR1cm4gYTsKCX0KCgl2YXIgaSxqLG4sdixlbCxtYXgsam1heDsKCWZvcihpPTAsIG1heD1lbHMubGVuZ3RoOyBpIDwgbWF4OyBpKyspIHsKCQllbCA9IGVsc1tpXTsKCQluID0gZWwubmFtZTsKCQlpZiAoIW4pIHsKCQkJY29udGludWU7CgkJfQoKCQlpZiAoc2VtYW50aWMgJiYgZm9ybS5jbGsgJiYgZWwudHlwZSA9PSAiaW1hZ2UiKSB7CgkJCS8vIGhhbmRsZSBpbWFnZSBpbnB1dHMgb24gdGhlIGZseSB3aGVuIHNlbWFudGljID09IHRydWUKCQkJaWYoIWVsLmRpc2FibGVkICYmIGZvcm0uY2xrID09IGVsKSB7CgkJCQlhLnB1c2goe25hbWU6IG4sIHZhbHVlOiAkKGVsKS52YWwoKX0pOwoJCQkJYS5wdXNoKHtuYW1lOiBuKycueCcsIHZhbHVlOiBmb3JtLmNsa194fSwge25hbWU6IG4rJy55JywgdmFsdWU6IGZvcm0uY2xrX3l9KTsKCQkJfQoJCQljb250aW51ZTsKCQl9CgoJCXYgPSAkLmZpZWxkVmFsdWUoZWwsIHRydWUpOwoJCWlmICh2ICYmIHYuY29uc3RydWN0b3IgPT0gQXJyYXkpIHsKCQkJZm9yKGo9MCwgam1heD12Lmxlbmd0aDsgaiA8IGptYXg7IGorKykgewoJCQkJYS5wdXNoKHtuYW1lOiBuLCB2YWx1ZTogdltqXX0pOwoJCQl9CgkJfQoJCWVsc2UgaWYgKHYgIT09IG51bGwgJiYgdHlwZW9mIHYgIT0gJ3VuZGVmaW5lZCcpIHsKCQkJYS5wdXNoKHtuYW1lOiBuLCB2YWx1ZTogdn0pOwoJCX0KCX0KCglpZiAoIXNlbWFudGljICYmIGZvcm0uY2xrKSB7CgkJLy8gaW5wdXQgdHlwZT09J2ltYWdlJyBhcmUgbm90IGZvdW5kIGluIGVsZW1lbnRzIGFycmF5ISBoYW5kbGUgaXQgaGVyZQoJCXZhciAkaW5wdXQgPSAkKGZvcm0uY2xrKSwgaW5wdXQgPSAkaW5wdXRbMF07CgkJbiA9IGlucHV0Lm5hbWU7CgkJaWYgKG4gJiYgIWlucHV0LmRpc2FibGVkICYmIGlucHV0LnR5cGUgPT0gJ2ltYWdlJykgewoJCQlhLnB1c2goe25hbWU6IG4sIHZhbHVlOiAkaW5wdXQudmFsKCl9KTsKCQkJYS5wdXNoKHtuYW1lOiBuKycueCcsIHZhbHVlOiBmb3JtLmNsa194fSwge25hbWU6IG4rJy55JywgdmFsdWU6IGZvcm0uY2xrX3l9KTsKCQl9Cgl9CglyZXR1cm4gYTsKfTsKCi8qKgogKiBTZXJpYWxpemVzIGZvcm0gZGF0YSBpbnRvIGEgJ3N1Ym1pdHRhYmxlJyBzdHJpbmcuIFRoaXMgbWV0aG9kIHdpbGwgcmV0dXJuIGEgc3RyaW5nCiAqIGluIHRoZSBmb3JtYXQ6IG5hbWUxPXZhbHVlMSZhbXA7bmFtZTI9dmFsdWUyCiAqLwokLmZuLmZvcm1TZXJpYWxpemUgPSBmdW5jdGlvbihzZW1hbnRpYykgewoJLy9oYW5kIG9mZiB0byBqUXVlcnkucGFyYW0gZm9yIHByb3BlciBlbmNvZGluZwoJcmV0dXJuICQucGFyYW0odGhpcy5mb3JtVG9BcnJheShzZW1hbnRpYykpOwp9OwoKLyoqCiAqIFNlcmlhbGl6ZXMgYWxsIGZpZWxkIGVsZW1lbnRzIGluIHRoZSBqUXVlcnkgb2JqZWN0IGludG8gYSBxdWVyeSBzdHJpbmcuCiAqIFRoaXMgbWV0aG9kIHdpbGwgcmV0dXJuIGEgc3RyaW5nIGluIHRoZSBmb3JtYXQ6IG5hbWUxPXZhbHVlMSZhbXA7bmFtZTI9dmFsdWUyCiAqLwokLmZuLmZpZWxkU2VyaWFsaXplID0gZnVuY3Rpb24oc3VjY2Vzc2Z1bCkgewoJdmFyIGEgPSBbXTsKCXRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQl2YXIgbiA9IHRoaXMubmFtZTsKCQlpZiAoIW4pIHsKCQkJcmV0dXJuOwoJCX0KCQl2YXIgdiA9ICQuZmllbGRWYWx1ZSh0aGlzLCBzdWNjZXNzZnVsKTsKCQlpZiAodiAmJiB2LmNvbnN0cnVjdG9yID09IEFycmF5KSB7CgkJCWZvciAodmFyIGk9MCxtYXg9di5sZW5ndGg7IGkgPCBtYXg7IGkrKykgewoJCQkJYS5wdXNoKHtuYW1lOiBuLCB2YWx1ZTogdltpXX0pOwoJCQl9CgkJfQoJCWVsc2UgaWYgKHYgIT09IG51bGwgJiYgdHlwZW9mIHYgIT0gJ3VuZGVmaW5lZCcpIHsKCQkJYS5wdXNoKHtuYW1lOiB0aGlzLm5hbWUsIHZhbHVlOiB2fSk7CgkJfQoJfSk7CgkvL2hhbmQgb2ZmIHRvIGpRdWVyeS5wYXJhbSBmb3IgcHJvcGVyIGVuY29kaW5nCglyZXR1cm4gJC5wYXJhbShhKTsKfTsKCi8qKgogKiBSZXR1cm5zIHRoZSB2YWx1ZShzKSBvZiB0aGUgZWxlbWVudCBpbiB0aGUgbWF0Y2hlZCBzZXQuICBGb3IgZXhhbXBsZSwgY29uc2lkZXIgdGhlIGZvbGxvd2luZyBmb3JtOgogKgogKiAgPGZvcm0+PGZpZWxkc2V0PgogKgkgIDxpbnB1dCBuYW1lPSJBIiB0eXBlPSJ0ZXh0IiAvPgogKgkgIDxpbnB1dCBuYW1lPSJBIiB0eXBlPSJ0ZXh0IiAvPgogKgkgIDxpbnB1dCBuYW1lPSJCIiB0eXBlPSJjaGVja2JveCIgdmFsdWU9IkIxIiAvPgogKgkgIDxpbnB1dCBuYW1lPSJCIiB0eXBlPSJjaGVja2JveCIgdmFsdWU9IkIyIi8+CiAqCSAgPGlucHV0IG5hbWU9IkMiIHR5cGU9InJhZGlvIiB2YWx1ZT0iQzEiIC8+CiAqCSAgPGlucHV0IG5hbWU9IkMiIHR5cGU9InJhZGlvIiB2YWx1ZT0iQzIiIC8+CiAqICA8L2ZpZWxkc2V0PjwvZm9ybT4KICoKICogIHZhciB2ID0gJCgnOnRleHQnKS5maWVsZFZhbHVlKCk7CiAqICAvLyBpZiBubyB2YWx1ZXMgYXJlIGVudGVyZWQgaW50byB0aGUgdGV4dCBpbnB1dHMKICogIHYgPT0gWycnLCcnXQogKiAgLy8gaWYgdmFsdWVzIGVudGVyZWQgaW50byB0aGUgdGV4dCBpbnB1dHMgYXJlICdmb28nIGFuZCAnYmFyJwogKiAgdiA9PSBbJ2ZvbycsJ2JhciddCiAqCiAqICB2YXIgdiA9ICQoJzpjaGVja2JveCcpLmZpZWxkVmFsdWUoKTsKICogIC8vIGlmIG5laXRoZXIgY2hlY2tib3ggaXMgY2hlY2tlZAogKiAgdiA9PT0gdW5kZWZpbmVkCiAqICAvLyBpZiBib3RoIGNoZWNrYm94ZXMgYXJlIGNoZWNrZWQKICogIHYgPT0gWydCMScsICdCMiddCiAqCiAqICB2YXIgdiA9ICQoJzpyYWRpbycpLmZpZWxkVmFsdWUoKTsKICogIC8vIGlmIG5laXRoZXIgcmFkaW8gaXMgY2hlY2tlZAogKiAgdiA9PT0gdW5kZWZpbmVkCiAqICAvLyBpZiBmaXJzdCByYWRpbyBpcyBjaGVja2VkCiAqICB2ID09IFsnQzEnXQogKgogKiBUaGUgc3VjY2Vzc2Z1bCBhcmd1bWVudCBjb250cm9scyB3aGV0aGVyIG9yIG5vdCB0aGUgZmllbGQgZWxlbWVudCBtdXN0IGJlICdzdWNjZXNzZnVsJwogKiAocGVyIGh0dHA6Ly93d3cudzMub3JnL1RSL2h0bWw0L2ludGVyYWN0L2Zvcm1zLmh0bWwjc3VjY2Vzc2Z1bC1jb250cm9scykuCiAqIFRoZSBkZWZhdWx0IHZhbHVlIG9mIHRoZSBzdWNjZXNzZnVsIGFyZ3VtZW50IGlzIHRydWUuICBJZiB0aGlzIHZhbHVlIGlzIGZhbHNlIHRoZSB2YWx1ZShzKQogKiBmb3IgZWFjaCBlbGVtZW50IGlzIHJldHVybmVkLgogKgogKiBOb3RlOiBUaGlzIG1ldGhvZCAqYWx3YXlzKiByZXR1cm5zIGFuIGFycmF5LiAgSWYgbm8gdmFsaWQgdmFsdWUgY2FuIGJlIGRldGVybWluZWQgdGhlCiAqCSAgIGFycmF5IHdpbGwgYmUgZW1wdHksIG90aGVyd2lzZSBpdCB3aWxsIGNvbnRhaW4gb25lIG9yIG1vcmUgdmFsdWVzLgogKi8KJC5mbi5maWVsZFZhbHVlID0gZnVuY3Rpb24oc3VjY2Vzc2Z1bCkgewoJZm9yICh2YXIgdmFsPVtdLCBpPTAsIG1heD10aGlzLmxlbmd0aDsgaSA8IG1heDsgaSsrKSB7CgkJdmFyIGVsID0gdGhpc1tpXTsKCQl2YXIgdiA9ICQuZmllbGRWYWx1ZShlbCwgc3VjY2Vzc2Z1bCk7CgkJaWYgKHYgPT09IG51bGwgfHwgdHlwZW9mIHYgPT0gJ3VuZGVmaW5lZCcgfHwgKHYuY29uc3RydWN0b3IgPT0gQXJyYXkgJiYgIXYubGVuZ3RoKSkgewoJCQljb250aW51ZTsKCQl9CgkJdi5jb25zdHJ1Y3RvciA9PSBBcnJheSA/ICQubWVyZ2UodmFsLCB2KSA6IHZhbC5wdXNoKHYpOwoJfQoJcmV0dXJuIHZhbDsKfTsKCi8qKgogKiBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgZmllbGQgZWxlbWVudC4KICovCiQuZmllbGRWYWx1ZSA9IGZ1bmN0aW9uKGVsLCBzdWNjZXNzZnVsKSB7Cgl2YXIgbiA9IGVsLm5hbWUsIHQgPSBlbC50eXBlLCB0YWcgPSBlbC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7CglpZiAoc3VjY2Vzc2Z1bCA9PT0gdW5kZWZpbmVkKSB7CgkJc3VjY2Vzc2Z1bCA9IHRydWU7Cgl9CgoJaWYgKHN1Y2Nlc3NmdWwgJiYgKCFuIHx8IGVsLmRpc2FibGVkIHx8IHQgPT0gJ3Jlc2V0JyB8fCB0ID09ICdidXR0b24nIHx8CgkJKHQgPT0gJ2NoZWNrYm94JyB8fCB0ID09ICdyYWRpbycpICYmICFlbC5jaGVja2VkIHx8CgkJKHQgPT0gJ3N1Ym1pdCcgfHwgdCA9PSAnaW1hZ2UnKSAmJiBlbC5mb3JtICYmIGVsLmZvcm0uY2xrICE9IGVsIHx8CgkJdGFnID09ICdzZWxlY3QnICYmIGVsLnNlbGVjdGVkSW5kZXggPT0gLTEpKSB7CgkJCXJldHVybiBudWxsOwoJfQoKCWlmICh0YWcgPT0gJ3NlbGVjdCcpIHsKCQl2YXIgaW5kZXggPSBlbC5zZWxlY3RlZEluZGV4OwoJCWlmIChpbmRleCA8IDApIHsKCQkJcmV0dXJuIG51bGw7CgkJfQoJCXZhciBhID0gW10sIG9wcyA9IGVsLm9wdGlvbnM7CgkJdmFyIG9uZSA9ICh0ID09ICdzZWxlY3Qtb25lJyk7CgkJdmFyIG1heCA9IChvbmUgPyBpbmRleCsxIDogb3BzLmxlbmd0aCk7CgkJZm9yKHZhciBpPShvbmUgPyBpbmRleCA6IDApOyBpIDwgbWF4OyBpKyspIHsKCQkJdmFyIG9wID0gb3BzW2ldOwoJCQlpZiAob3Auc2VsZWN0ZWQpIHsKCQkJCXZhciB2ID0gb3AudmFsdWU7CgkJCQlpZiAoIXYpIHsgLy8gZXh0cmEgcGFpbiBmb3IgSUUuLi4KCQkJCQl2ID0gKG9wLmF0dHJpYnV0ZXMgJiYgb3AuYXR0cmlidXRlc1sndmFsdWUnXSAmJiAhKG9wLmF0dHJpYnV0ZXNbJ3ZhbHVlJ10uc3BlY2lmaWVkKSkgPyBvcC50ZXh0IDogb3AudmFsdWU7CgkJCQl9CgkJCQlpZiAob25lKSB7CgkJCQkJcmV0dXJuIHY7CgkJCQl9CgkJCQlhLnB1c2godik7CgkJCX0KCQl9CgkJcmV0dXJuIGE7Cgl9CglyZXR1cm4gJChlbCkudmFsKCk7Cn07CgovKioKICogQ2xlYXJzIHRoZSBmb3JtIGRhdGEuICBUYWtlcyB0aGUgZm9sbG93aW5nIGFjdGlvbnMgb24gdGhlIGZvcm0ncyBpbnB1dCBmaWVsZHM6CiAqICAtIGlucHV0IHRleHQgZmllbGRzIHdpbGwgaGF2ZSB0aGVpciAndmFsdWUnIHByb3BlcnR5IHNldCB0byB0aGUgZW1wdHkgc3RyaW5nCiAqICAtIHNlbGVjdCBlbGVtZW50cyB3aWxsIGhhdmUgdGhlaXIgJ3NlbGVjdGVkSW5kZXgnIHByb3BlcnR5IHNldCB0byAtMQogKiAgLSBjaGVja2JveCBhbmQgcmFkaW8gaW5wdXRzIHdpbGwgaGF2ZSB0aGVpciAnY2hlY2tlZCcgcHJvcGVydHkgc2V0IHRvIGZhbHNlCiAqICAtIGlucHV0cyBvZiB0eXBlIHN1Ym1pdCwgYnV0dG9uLCByZXNldCwgYW5kIGhpZGRlbiB3aWxsICpub3QqIGJlIGVmZmVjdGVkCiAqICAtIGJ1dHRvbiBlbGVtZW50cyB3aWxsICpub3QqIGJlIGVmZmVjdGVkCiAqLwokLmZuLmNsZWFyRm9ybSA9IGZ1bmN0aW9uKCkgewoJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkkKCdpbnB1dCxzZWxlY3QsdGV4dGFyZWEnLCB0aGlzKS5jbGVhckZpZWxkcygpOwoJfSk7Cn07CgovKioKICogQ2xlYXJzIHRoZSBzZWxlY3RlZCBmb3JtIGVsZW1lbnRzLgogKi8KJC5mbi5jbGVhckZpZWxkcyA9ICQuZm4uY2xlYXJJbnB1dHMgPSBmdW5jdGlvbigpIHsKCXZhciByZSA9IC9eKD86Y29sb3J8ZGF0ZXxkYXRldGltZXxlbWFpbHxtb250aHxudW1iZXJ8cGFzc3dvcmR8cmFuZ2V8c2VhcmNofHRlbHx0ZXh0fHRpbWV8dXJsfHdlZWspJC9pOyAvLyAnaGlkZGVuJyBpcyBub3QgaW4gdGhpcyBsaXN0CglyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCXZhciB0ID0gdGhpcy50eXBlLCB0YWcgPSB0aGlzLnRhZ05hbWUudG9Mb3dlckNhc2UoKTsKCQlpZiAocmUudGVzdCh0KSB8fCB0YWcgPT0gJ3RleHRhcmVhJykgewoJCQl0aGlzLnZhbHVlID0gJyc7CgkJfQoJCWVsc2UgaWYgKHQgPT0gJ2NoZWNrYm94JyB8fCB0ID09ICdyYWRpbycpIHsKCQkJdGhpcy5jaGVja2VkID0gZmFsc2U7CgkJfQoJCWVsc2UgaWYgKHRhZyA9PSAnc2VsZWN0JykgewoJCQl0aGlzLnNlbGVjdGVkSW5kZXggPSAtMTsKCQl9Cgl9KTsKfTsKCi8qKgogKiBSZXNldHMgdGhlIGZvcm0gZGF0YS4gIENhdXNlcyBhbGwgZm9ybSBlbGVtZW50cyB0byBiZSByZXNldCB0byB0aGVpciBvcmlnaW5hbCB2YWx1ZS4KICovCiQuZm4ucmVzZXRGb3JtID0gZnVuY3Rpb24oKSB7CglyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCS8vIGd1YXJkIGFnYWluc3QgYW4gaW5wdXQgd2l0aCB0aGUgbmFtZSBvZiAncmVzZXQnCgkJLy8gbm90ZSB0aGF0IElFIHJlcG9ydHMgdGhlIHJlc2V0IGZ1bmN0aW9uIGFzIGFuICdvYmplY3QnCgkJaWYgKHR5cGVvZiB0aGlzLnJlc2V0ID09ICdmdW5jdGlvbicgfHwgKHR5cGVvZiB0aGlzLnJlc2V0ID09ICdvYmplY3QnICYmICF0aGlzLnJlc2V0Lm5vZGVUeXBlKSkgewoJCQl0aGlzLnJlc2V0KCk7CgkJfQoJfSk7Cn07CgovKioKICogRW5hYmxlcyBvciBkaXNhYmxlcyBhbnkgbWF0Y2hpbmcgZWxlbWVudHMuCiAqLwokLmZuLmVuYWJsZSA9IGZ1bmN0aW9uKGIpIHsKCWlmIChiID09PSB1bmRlZmluZWQpIHsKCQliID0gdHJ1ZTsKCX0KCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJdGhpcy5kaXNhYmxlZCA9ICFiOwoJfSk7Cn07CgovKioKICogQ2hlY2tzL3VuY2hlY2tzIGFueSBtYXRjaGluZyBjaGVja2JveGVzIG9yIHJhZGlvIGJ1dHRvbnMgYW5kCiAqIHNlbGVjdHMvZGVzZWxlY3RzIGFuZCBtYXRjaGluZyBvcHRpb24gZWxlbWVudHMuCiAqLwokLmZuLnNlbGVjdGVkID0gZnVuY3Rpb24oc2VsZWN0KSB7CglpZiAoc2VsZWN0ID09PSB1bmRlZmluZWQpIHsKCQlzZWxlY3QgPSB0cnVlOwoJfQoJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQl2YXIgdCA9IHRoaXMudHlwZTsKCQlpZiAodCA9PSAnY2hlY2tib3gnIHx8IHQgPT0gJ3JhZGlvJykgewoJCQl0aGlzLmNoZWNrZWQgPSBzZWxlY3Q7CgkJfQoJCWVsc2UgaWYgKHRoaXMudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09ICdvcHRpb24nKSB7CgkJCXZhciAkc2VsID0gJCh0aGlzKS5wYXJlbnQoJ3NlbGVjdCcpOwoJCQlpZiAoc2VsZWN0ICYmICRzZWxbMF0gJiYgJHNlbFswXS50eXBlID09ICdzZWxlY3Qtb25lJykgewoJCQkJLy8gZGVzZWxlY3QgYWxsIG90aGVyIG9wdGlvbnMKCQkJCSRzZWwuZmluZCgnb3B0aW9uJykuc2VsZWN0ZWQoZmFsc2UpOwoJCQl9CgkJCXRoaXMuc2VsZWN0ZWQgPSBzZWxlY3Q7CgkJfQoJfSk7Cn07CgovLyBoZWxwZXIgZm4gZm9yIGNvbnNvbGUgbG9nZ2luZwpmdW5jdGlvbiBsb2coKSB7Cgl2YXIgbXNnID0gJ1tqcXVlcnkuZm9ybV0gJyArIEFycmF5LnByb3RvdHlwZS5qb2luLmNhbGwoYXJndW1lbnRzLCcnKTsKCWlmICh3aW5kb3cuY29uc29sZSAmJiB3aW5kb3cuY29uc29sZS5sb2cpIHsKCQl3aW5kb3cuY29uc29sZS5sb2cobXNnKTsKCX0KCWVsc2UgaWYgKHdpbmRvdy5vcGVyYSAmJiB3aW5kb3cub3BlcmEucG9zdEVycm9yKSB7CgkJd2luZG93Lm9wZXJhLnBvc3RFcnJvcihtc2cpOwoJfQp9OwoKfSkoalF1ZXJ5KTsK</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>